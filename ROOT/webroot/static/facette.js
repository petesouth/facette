/*!
 * Facette - Web graphing front-end
 * @author   Vincent Batoufflet <vincent@facette.io>
 * @link     https://facette.io/
 * @license  BSD
 */
$(function(){"use strict";function t(t){var e,a=[],n=t.length;for(e=0;n>e;e++)-1==a.indexOf(t[e])&&a.push(t[e]);return a}function e(t,e,a){var n;a=a||{};for(n in e)"object"!=typeof e[n]&&t.find("."+n).text(a[n]?a[n](e[n]):e[n])}function a(t,e){var a;switch(e=e||{},e.unit_type){case sa:a=sprintf(e.formatter||"%.2f",t);break;case oa:a=i(t,e.formatter);break;default:a=t}return e.unit&&(a+=" "+e.unit),a}function n(){var t={};return $.each(window.location.search.substr(1).split("&"),function(e,a){var n=a.indexOf("=");-1==n?t[a]=void 0:t[a.substr(0,n)]=a.substr(n+1)}),t}function i(t,e){var a,n=["","k","M","G","T","P","E","Z","Y"];return 0===t?"0":(a=parseInt(Math.log(Math.abs(t))/Math.log(1e3),10),sprintf(e||"%.2f",t/Math.pow(1e3,a))+(a>0?" "+n[a]:""))}function r(t){return $.map(t.split(","),function(t){return parseFloat(t.trim())})}function s(t){var e;return t?(e=t.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*\d+)?\)$/),"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2)):null}function o(t){var e,a,n,i,r=$.map(t.split(";"),$.trim),s={};for(e in r)a=r[e].indexOf(":"),n=r[e].substr(0,a).trim(),i=r[e].substr(a+1).trim(),$.isNumeric(i)?i=parseFloat(i):-1!=["false","true"].indexOf(i.toLowerCase())&&(i="true"==i.toLowerCase()),s[n]=i;return s}function l(t){var e,a,n,i,r={d:864e5,h:36e5,m:6e4,s:1e3},s=[];n=Math.abs(t);for(a in r)e=Math.floor(n/r[a]),e>0&&(s.push(e+a),n%=r[a]);return i=s.join(" "),0>t&&(i="-"+i),i}function d(t){var e;switch(t){case"circle":e="●";break;case"diamond":e="♦";break;case"square":e="■";break;case"triangle":e="▲";break;case"triangle-down":e="▼"}return e}function c(t){var e,a=[];for(e in _a[t])a.push(_a[t][e]());return $.when.apply(null,a)}function u(t,e){_a[t]||(_a[t]=[]),_a[t].push(e)}function p(){ka=$("#console"),kt("console-close",function(){f(null)}),f(null)}function f(t){t&&ka.is(":hidden")&&ka.show(),ka.children(".message").text(t),ka.animate({top:t?0:-1*ka.outerHeight(!0)},200,function(){t||ka.hide()})}function g(t,e){var a,n,i;return Aa[t]?(n=Aa[t].clone().appendTo(Ca.show()).data("args",e).on("click","button",function(e){var a,n,i=null;-1!=["cancel","reset","validate"].indexOf(e.target.name)&&(a=$(e.target).closest("[data-overlay]"),n=a.data("args"),n&&n.callbacks&&("prompt"!=t&&"select"!=t||("reset"==e.target.name?(i=n.reset,e.target.name="validate"):i=a.find("input[name=value]").val()),n.callbacks[e.target.name]&&n.callbacks[e.target.name](i),n.callbacks.terminate&&n.callbacks.terminate()),m(a))}),je.on("keydown",h),e&&(e.message&&n.find(".message").html(e.message),e.labels&&$.each(e.labels,function(t,e){var a=n.find("button[name="+t+"]");e.text&&a.text(e.text),e.style&&a.addClass(e.style)}),"prompt"!=t&&"select"!=t||("select"==t&&(i=n.find("[data-select]"),e.options&&$.each(e.options,function(t,e){$(document.createElement("option")).appendTo(i).attr("value",e[1]).text(e[0])}),$t(i.get(0))),a=n.find("input[type=text]:first"),e.value&&a.val(e.value),void 0===e.reset&&n.find("button[name=reset]").remove(),setTimeout(function(){a.select()},0))),n):void console.error("Unable find `"+t+"' overlay")}function m(t){"string"==typeof t&&(t=v(t)),0!==t.length&&(t.remove(),0===Ca.find("[data-overlay]").length&&Ca.hide(),je.off("keydown",h))}function h(t){13!=t.which&&27!=t.which||(Ca.children("[data-overlay]").each(function(){$(this).find("button[name="+(13==t.which||27==t.which&&"alert"==this.getAttribute("data-overlay")?"validate":"cancel")+"]").trigger("click")}),t.preventDefault())}function v(t){return Ca.children("[data-overlay="+t+"]")}function b(){Ca=$("#overlay").hide(),Ca.find(".box, .loader").each(function(){var t=$(this);Aa[t.attr("data-overlay")]=t.detach()})}function y(t,e){var a;return"string"==typeof t&&(t=T(t)),a=t.data("template").clone().attr("data-listitem",t.attr("data-list")+"-item"+t.data("counter")),t.data("counter",t.data("counter")+1),e?a.insertAfter(e):a.appendTo(t.data("container")),a.is("[data-list]")&&w(a.get(0)),a.find("[data-list]").each(function(){w(this)}),a}function x(t){"string"==typeof t&&(t=T(t)),t.data({counter:0,offset:0}),_(t).remove(),j(t,0)}function k(t,e){return _(t,e).length}function _(t,e){return"string"==typeof t&&(t=T(t)),t.find('[data-listitem^="'+t.attr("data-list")+'-item"]'+(e||""))}function w(t){return $.Deferred(function(e){var a,n=$(t);return $.contains(document.documentElement,t)?(a=n.find('[data-listtmpl="'+t.getAttribute("data-list")+'"]').removeAttr("data-listtmpl"),n.data({counter:0,offset:0,template:a,container:a.parent()}),a.detach(),O(n,null),void(n.opts("list").init?S(n).then(function(){e.resolve()}):(O(n,$.t((n.opts("list").messages||"item")+".mesg_none"),"info"),e.resolve()))):void e.resolve()}).promise()}function T(t,e){return e=e||"",$("[data-list"+e+'="'+t+'"]')}function C(t,e){var a=-1,n=e.substr(5);return"string"==typeof t&&(t=T(t)),_(t).each(function(){var t,i=this.getAttribute(e);i.startsWith(n)&&(t=parseInt(i.replace(new RegExp("^"+n),""),10),isNaN(t)||(a=Math.max(a,t)))}),n+(a+1)}function A(t,e){Oa[t]=e}function O(t,e,a){var n;"string"==typeof t&&(t=T(t)),n=t.find('[data-listmesg="'+t.attr("data-list")+'"]').removeClass("success info warning error").text(e||"").toggle(!!e),a&&n.addClass(a)}function W(){var t;t=$("[data-listfilter]").each(function(){this.setAttribute("autocomplete","off"),this._lastValue="",this._list=je.find('[data-list="'+this.getAttribute("data-listfilter")+'"]').get(0)}),t.length>0&&je.on("keyup","[data-listfilter]",function(t){var e=t.target.getAttribute("data-listfilter");27==t.which&&(t.target.value=""),(t._force||t.target.value!=t.target._lastValue)&&(Wa[e]&&clearTimeout(Wa[e]),Wa[e]=setTimeout(function(){S($(t.target._list),t.target.value),t.target._lastValue=t.target.value},200))})}function D(){return $.Deferred(function(t){var e,a=[];e=$("[data-list]").each(function(){a.push(w(this))}),$.when.apply(null,a).then(function(){t.resolve()}),e.length>0&&je.on("click","[data-listmesg] a",function(t){var e=$(t.target),a={type:"keyup",_force:!0};if("#reset"==e.attr("href"))a.which=27;else if("#retry"!=e.attr("href"))return;$('[data-listfilter="'+e.closest("[data-list]").attr("data-list")+'"]').trigger(a),t.preventDefault(),t.stopImmediatePropagation()})}).promise()}function I(){var t;t=$("[data-listmore]"),t.length>0&&je.on("click","[data-listmore]",function(t){var e=t.target.getAttribute("data-listmore");S(e,T(e,"filter").val(),k(e))})}function S(t,e,a){var n,i,r;return a=parseInt(a,10)||0,"string"==typeof t&&(t=T(t)),i=setTimeout(function(){g("loader",{message:$.t("main.mesg_loading")})},500),0===a&&(x(t),T(t.attr("data-list"),"more").attr("disabled","disabled")),r=t.opts("list").url,n={url:Ve+"/api/v1/"+r,type:"GET",data:{offset:a,limit:ba}},e&&(n.data.filter="glob:*"+e+"*"),$.ajax(n).done(function(a,n,i){var r,s,o,l=t.attr("data-list"),d=parseInt(i.getResponseHeader("X-Total-Records"),10);if(!a||a instanceof Array&&0===a.length)return s=t.opts("list").messages||"item",void(e?(O(t,$.t(s+".mesg_load_nomatch"),"warning"),$(document.createElement("a")).appendTo(t.find("[data-listmesg]")).attr("href","#reset").text($.t("list.labl_reset"))):O(t,$.t(s+".mesg_none"),"info"));O(t,null);for(o in a)"string"!=typeof a[o]?(r=y(t).attr("data-itemid",a[o].id),r.find(".name").text(a[o].name),r.find(".desc").text(a[o].description||$.t("main.mesg_no_description")),r.find(".date span").text(moment(a[o].modified).format(ya)),a[o].description||r.find(".desc").addClass("placeholder"),Oa[l]&&Oa[l](r,a[o])):y(t).attr("data-itemname",a[o]).find(".name").text(a[o]);j(t,d),k(t)<d?T(t.attr("data-list"),"more").removeAttr("disabled"):T(t.attr("data-list"),"more").attr("disabled","disabled")}).fail(function(){x(t),O(t,$.t("list.mesg_load_error"),"error"),$(document.createElement("a")).appendTo(t.find("[data-listmesg]")).attr("href","#retry").text($.t("list.labl_retry"))}).always(function(){i&&clearTimeout(i),m("loader")})}function j(t,e){"string"==typeof t&&(t=T(t)),t.find("h1 .count").text((e?e:k(t))||"")}function E(t){return t.data("template").clone().appendTo(t.children(".treecntr"))}function H(t){t.children(".treecntr").empty()}function V(t){return $.Deferred(function(e){var a,n=$(t);return $.contains(document.documentElement,t)?(a=n.find(".treetmpl:first").removeClass("treetmpl"),n.data("template",a),a.detach(),n.children(".placeholder").hide(),void L(n).then(function(){e.resolve()})):void e.resolve()}).promise()}function N(t){return $("[data-tree="+t+"]")}function B(){return $.Deferred(function(t){var e=[];$("[data-tree]").each(function(){e.push(V(this))}),$.when.apply(null,e).then(function(){t.resolve()})}).promise()}function L(t){var e,a,n={};return"string"==typeof t&&(t=N(t)),a=setTimeout(function(){g("loader",{message:$.t("main.mesg_loading")})},500),e=t.opts("tree"),e.base&&(n.parent=e.base),$.ajax({url:Ve+"/api/v1/"+e.url,type:"GET",data:n}).pipe(function(e){var a,n;if(H(t),t.children(".placeholder").toggle(0===e.length),0!==e.length){for(n in e)a=E(t).attr("data-treeitem",e[n].id).attr("title",e[n].name),e[n].has_children&&a.addClass("folded"),a.find(".name").text(e[n].name);for(n in e)null!==e[n].parent&&$("[data-treeitem="+e[n].id+"]").detach().appendTo($("[data-treeitem="+e[n].parent+"]").children(".treecntr").hide());M(t)}}).fail(function(){H(t)}).always(function(){a&&clearTimeout(a),m("loader")})}function M(t){var e,a,n=0;"string"==typeof t&&(t=N(t)),e=t.find(".treecntr"),a=Math.abs(parseInt(e.first().find(".treelabl").css("margin-left"),10)),e.each(function(){var t=-(a*n);$(this).closest(".treeitem").find(".treelabl").css({marginLeft:t,marginRight:t,paddingLeft:Math.abs(t)}),n+=1})}function P(t,e){return e&&(Sa[t]=e),$('[data-tooltip="'+t+'"]').remove(),U(Da.clone().attr("data-tooltip",t),!0)}function z(t){0===$(t.target).closest("[data-tooltip]").length&&U(null,!1)}function R(t){27==t.which&&U(null,!1)}function G(t){return $('[data-tooltip="'+t+'"]')}function Y(){Da=$("[data-tooltip=template]").detach()}function U(t,e){return t?("string"==typeof t&&(t=G(t)),e="boolean"==typeof e?e:t.is(":hidden"),e?(Ia||je.on("keydown",R).on("click",z),Ia=t):Ia&&t.get(0)==Ia.get(0)&&(Ia=null,je.off("keydown",R).off("click",z)),Sa[t.attr("data-tooltip")]&&Sa[t.attr("data-tooltip")](e),t.toggle(e)):void $("[data-tooltip]").each(function(){U($(this),e)})}function F(t){return"string"==typeof t&&(t=Q(t)),Ea.clone().appendTo(t.find("[data-menucntr]"))}function J(t){return ja.clone().attr("data-menu",t).hide()}function X(t){"string"==typeof t&&(t=Q(t)),t.find("[data-menuitem]").remove()}function K(t){0===$(t.target).closest("[data-menu], [data-input], [data-select]").length&&at(null,!1)}function Z(t){var e,a,n,i,r;if(-1==[Le,Be,Ye,Re].indexOf(t.which)||!Ha)return void(t.which==Pe&&at(Ha,!1));if(t.preventDefault(),Na&&clearTimeout(Na),a=Ha.find("[data-menuitem]"),i=a.filter(".selected"),t.which==Le||t.which==Be){if(t.which==Be&&(t.shiftKey||0===Ha.closest("[data-input]").length))return;return i.trigger({type:"click",which:1}),void at(Ha,!1)}t.which==Re?(Va=!0,e=i.prevAll("[data-menuitem]:not(.noselect)").first(),0===e.length&&(e=a.not(".noselect").last())):t.which==Ye&&(Va=!0,e=i.nextAll("[data-menuitem]:not(.noselect)").first(),0===e.length&&(e=a.not(".noselect").first())),e.addClass("selected").siblings().removeClass("selected"),r=e.position(),r&&(n=Ha.find("[data-menucntr]"),r.top+e.outerHeight(!0)>n.innerHeight()?n.scrollTop(n.scrollTop()+r.top-n.innerHeight()+e.outerHeight(!0)+(n.outerHeight()-n.innerHeight())):r.top<0&&n.scrollTop(n.scrollTop()+r.top)),Va&&(Na=setTimeout(function(){Va=!1,je.on("mousemove","[data-menuitem]",q)},200))}function q(t){var e;Va||("mouseenter"==t.type||"mousemove"==t.type?(e=$(t.target).closest("[data-menuitem]"),e.hasClass("noselect")||e.addClass("selected").siblings().removeClass("selected"),"mousemove"==t.type&&je.off("mousemove","[data-menuitem]",q)):$(t.target).closest("[data-menu]").find("[data-menuitem].selected").removeClass("selected"))}function Q(t){return $('[data-menu="'+t+'"]')}function tt(t,e,a){"string"==typeof t&&(t=Q(t)),t.find("[data-menumesg]").attr("data-menumesg",a||"info").text(e||"").toggle(!!e),e&&at(t,!0)}function et(){ja=$("[data-menu=template]"),Ea=ja.find("[data-menuitem=template]").detach(),ja.detach()}function at(t,e){return t?("string"==typeof t&&(t=Q(t)),e="boolean"==typeof e?e:t.is(":hidden"),e?(Ha&&t.get(0)!=Ha.get(0)?at(Ha,!1):Ha||je.on("keydown",Z).on("mouseenter","[data-menuitem]",q).on("mouseleave","[data-menu]",q),Ha=t,t.find("[data-menuitem].selected").removeClass("selected")):Ha&&t.get(0)==Ha.get(0)&&(Ha=null,je.off("keydown",Z).off("mouseenter","[data-menuitem]",q).off("mouseleave","[data-menu]",q)),void t.toggle(e)):void $("[data-menu]").each(function(){at($(this),e)})}function nt(t,e){var a,n,i={};return e=e||{},"string"==typeof t&&(t=ct(t)),a=t.children(":input"),a.val()&&(e.filter="glob:"+a.val()+"*"),n=$.map((t.opts("input").sources||"").split(","),$.trim)||[],$.each(n,function(t,a){i[a]={url:Ve+"/api/v1/"+a,type:"GET",data:e}}),i}function it(t){var e=$(t.target).closest("[data-menuitem]"),a=$(t.target).closest("[data-input]"),n=e.data("value");a.children(":input").data("value",n).val(n.name).focus(),at(a.attr("data-input"),!1)}function rt(t){var e=$(t.target).closest("[data-input]").attr("data-input");t.target.value!=t.target._lastValue&&Q(e).trigger({type:"keydown",which:Le}),t.target._lastValue=null,Pa[e]&&$.each(Pa[e],function(t,e){e.abort()})}function st(t){var e=$(t.target).closest("[data-input]");e.opts("input").check?ot(t):e.opts("input").sources&&lt(t)}function ot(t){var e=$(t.target).closest("[data-input]"),a=e.attr("data-input");za[a]&&clearTimeout(za[a]),za[a]=setTimeout(function(){La[a]&&La[a](e)},1e3)}function lt(t){var e,a,n,i,r=$(t.target),s=r.closest("[data-input]"),o=s.attr("data-input");if(t.which!=Me){if(t.which==Le)return t.target._lastValue=t.target.value,t.target.setSelectionRange(t.target.value.length,t.target.value.length),void r.trigger("change");if(t.which==Be){if(!t.target._lastValue)return;return void r.trigger({type:"keyup",which:Le})}if(t.which==Pe)return t.target.value=t.target.value!==t.target._lastValue?t.target._lastValue:"",t.target._lastValue=null,r.removeData("value"),void(r.val()||r.trigger("change"));if(t.which==Re||t.which==Ye){if(e=Q(o),n=t.target._lastValue?t.target._lastValue.length:0,i=(e.find("[data-menuitem].selected").data("value")||{}).name,!i)return;return t.target.value=i,void t.target.setSelectionRange(n,i.length)}if(za[o]&&clearTimeout(za[o]),t.target.value||r.removeData("value"),a=s.opts("input")||{},a.ignorepattern&&-1!=t.target.value.indexOf(a.ignorepattern))return void at(e,!1);if(!t._autofill){if(t.target.value==t.target._lastValue)return;if(!t.target.value)return void(t.target._lastValue=null)}za[o]=setTimeout(function(){var e,a=Q(o),n={};e=Ma[o]?Ma[o](s)||[]:nt(s)||[],0!==e.length&&(Pa[o]=[],t._autofill||(tt(a,"Loading..."),X(a)),$.each(e,function(e,a){n[e]=null,a.beforeSend=function(t){t._source=e},a.success=function(t,e,a){n[a._source]={data:t,total:parseInt(a.getResponseHeader("X-Total-Records"),10)}},t._autofill&&(a.data=$.extend(a.data,{limit:1})),Pa[o].push($.ajax(a))}),$.when.apply(null,Pa[o]).then(function(){var e,a=[];if(t._autofill){for(e in n)0!==n[e].data.length&&a.push.apply(a,n[e].data);1==a.length&&1==n[e].total&&("string"==typeof a[0]?a[0]={name:a[0],source:e}:a[0].source=e,r.data("value",a[0]).val(a[0].name).trigger({type:"change",_autofill:!0}),t._init||r.select())}else gt(s,n);delete Pa[o]}),t.target._lastValue=t.target.value)},500)}}function dt(t){var e,a,n,i=$(t);t.value=t._lastValue="",e=Ba.clone().insertBefore(t).attr("class",i.attr("class")).attr("data-input",i.attr("data-input")).attr("data-inputopts",i.attr("data-inputopts")),i.detach().appendTo(e).removeAttr("class").removeAttr("data-input").removeAttr("data-inputopts"),n=e.opts("input"),n.sources&&(t.setAttribute("autocomplete","off"),a=J(t.getAttribute("data-input")).appendTo(e).attr("data-menu",e.attr("data-input")),a.css("min-width",e.width()),(void 0===n.autofill||n.autofill)&&e.find("input").trigger({type:"keyup",_autofill:!0}))}function ct(t){return $('[data-input="'+t+'"]')}function ut(t,e){La[t]=e}function pt(t,e){Ma[t]=e}function ft(){Ba=$("[data-input=template]").detach(),$("[data-input]").each(function(){dt(this)}),"autofocus"in document.createElement("input")||$("[autofocus]:first").select()}function gt(t,e){var a,n,i,r;"string"==typeof t&&(t=ct(t)),r=t.attr("data-input"),a=Q(r),tt(a,null),n=0,$.each(e,function(t,e){e.data&&$.each(e.data,function(e,i){"string"==typeof i?i={name:i,source:t}:i.source=t,F(a).attr("data-menuitem",r+n).attr("data-menusource",t).attr("title",i.name).data("value",i).text(i.name),n++})}),at(a,!0),0===a.find("[data-menuitem]").length?tt(a,$.t("main.mesg_nomatch"),"warn"):(i=t.children(":input").get(0),t.trigger({target:i,type:"keydown",which:Ye}),t.trigger({target:i,type:"keyup",which:Ye}))}function mt(t){var e,a;t._select||(e=$(t.target),a=e.closest("[data-select]"),a.find('[data-menuitem="'+e.val()+'"]').trigger({type:"click",_init:t._init||!1}))}function ht(t){var e=$(t.target),a=e.closest("[data-menuitem]"),n=e.closest("[data-select]");0===a.length?at(n.attr("data-select")):(n.find("[data-selectlabel]").text(a.text()),n.children("select").val(a.data("value")).trigger({type:"change",_init:t._init||!1,_select:!0}),at(n.attr("data-select"),!1))}function vt(t){"focusin"==t.type?je.on("keydown keyup",bt):je.off("keydown keyup",bt)}function bt(t){var e;return"keydown"==t.type?void(-1!=[Re,ze,Ye,Ge].indexOf(t.which)&&t.preventDefault()):(e=$("[data-selectlabel]:focus").closest("[data-select]"),void(Q(e.attr("data-select")).is(":visible")||(t.which==Re||t.which==ze?e.find('[data-menuitem="'+e.children("select").val()+'"]').prev("[data-menuitem]").trigger("click"):t.which!=Ye&&t.which!=Ge||e.find('[data-menuitem="'+e.children("select").val()+'"]').next("[data-menuitem]").trigger("click"))))}function $t(t){var e,a,n=$(t);a=Ra.clone().insertBefore(t).attr("data-select",n.attr("data-select")),e=J(t.getAttribute("data-select")).appendTo(a).attr("data-menu",a.attr("data-select")),n.detach().appendTo(a).removeAttr("data-select").hide(),a.find("[data-selectlabel]").attr("tabindex",0),yt(t)}function yt(t){var e=$(t),a=e.closest("[data-select]"),n=a.find("[data-menu]");X(n),e.children("option").each(function(){F(n).attr("data-menuitem",this.value).data("value",this.value).text($(this).text())}),e.trigger({type:"change",_init:!0}),n.width()>a.width()?a.width(n.width()):n.css("min-width",a.width())}function xt(){Ra=$("[data-select=template]").detach(),$("[data-select]").each(function(){$t(this)})}function kt(t,e){$.each($.map(t.split(" "),$.trim),function(t,a){Ga[a]=e})}function _t(t){var e;for(e in Ga)t.target.href&&t.target.href.endsWith("#"+e)&&("disabled"!=t.target.getAttribute("disabled")&&Ga[e](t),t.preventDefault())}function wt(t){Ua&&clearTimeout(Ua),Ua=setTimeout(function(){$(t.target).trigger({type:"change",_typing:!0})},200)}function Tt(t,e){e=$(t.target).closest("[data-pane]").attr("data-pane"),"step-ok"==t.target.name?Ce(e,Ya[e].last):"step-prev"==t.target.name&&Ya[e].active>1?Ce(e,Ya[e].active-1):"step-next"==t.target.name&&Ya[e].active<Ya[e].count&&Ce(e,Ya[e].active+1)}function Ct(t){var e=Ae(t+"-list").opts("pane").section;kt("show-info",function(t){var e,a=$(t.target),n=a.closest("[data-listitem]");e=P("info",function(t){a.toggleClass("active",t),n.toggleClass("action",t)}).appendTo(je).css({top:a.offset().top,left:a.offset().left}),e.html('<span class="label">id:</span> '+n.attr("data-itemid"))}),kt("show-"+t,function(t){window.location=Ve+"/browse/"+e+"/"+$(t.target).closest("[data-itemid]").attr("data-itemid")}),kt("edit-"+t,function(t){var a,n=$(t.target).closest("[data-itemid]");a=Ve+"/admin/"+e+"/"+n.attr("data-itemid"),n.data("params")&&(a+="?"+n.data("params")),window.location=a}),kt("clone-"+t,function(a){var n=$(a.target).closest("[data-itemid]");g("prompt",{message:$.t(t+".labl_"+t+"_name"),value:n.find(".name").text()+" (clone)",callbacks:{validate:function(t){t&&he(n.attr("data-itemid"),e,{name:t},!0).then(function(){S(n.closest("[data-list]"),n.closest("[data-pane]").find("[data-listfilter="+e+"]").val())})}},labels:{validate:{text:$.t(t+".labl_clone")}}})}),kt("remove-"+t,function(a){var n=$(a.target).closest("[data-itemid]");g("confirm",{message:$.t(t+".mesg_delete",{name:"<strong>"+n.find(".name").text()+"</strong>"}),callbacks:{validate:function(){fe(n.attr("data-itemid"),e).then(function(){S(n.closest("[data-list]"),n.closest("[data-pane]").find("[data-listfilter="+e+"]").val())}).fail(function(){g("alert",{message:$.t(t+".mesg_delete_fail")})})}},labels:{validate:{text:$.t(t+".labl_delete"),style:"danger"}}})})}function At(t,e,a,n){var i,r=t.opts("pane").section,s=t.data("redirect-params");return i=t.find("input[name="+a+"-name]"),i.val()?void he(e,r,n(),null).then(function(){Qa=!1,window.location=Ve+"/admin/"+r+"/"+(s?"?"+s:"")}).fail(function(){g("alert",{message:$.t(a+".mesg_save_fail")})}):(i.closest("[data-input], textarea").attr("title",$.t("main.mesg_field_mandatory")).addClass("error"),void i.focus())}function Ot(t){var e,a=$(t.target),n=a.closest("[data-listitem]");if(t.target.href.endsWith("#move-up")){if(e=n.prevAll("[data-listitem]:first"),0===e.length)return;n.detach().insertBefore(e)}else{if(e=n.nextAll("[data-listitem]:first"),0===e.length)return;n.detach().insertAfter(e)}}function Wt(t){var a,n,i=T("step-1-graphs");return a=y(i).attr("data-graph",t.id).data("value",t),e(a,t),a.find(".toggle a[href=#hide-options]").hide(),a.find(".options").hide(),n="graph-shown-item"+(k(i)-1),a.find("input[name=graph-shown]").attr("id",n),a.find("label[for=graph-shown]").attr("for",n),a}function Dt(){var t=Ae("collection-edit"),e={name:t.find("input[name=collection-name]").val(),description:t.find("textarea[name=collection-desc]").val(),parent:(t.find("input[name=collection-parent]").data("value")||{id:null}).id,entries:[]},a=t.find("input[name=collection-refresh-interval]").val();return a&&(e.options={refresh_interval:parseInt(a,10)}),_("step-1-graphs").each(function(){var t,a,n=$(this),i=n.find("input[name=graph-range]"),s=n.find("input[name=graph-title]");t={title:s.val()||null,range:i.val()||null,constants:n.find("input[name=graph-constants]").val(),percentiles:n.find("input[name=graph-percentiles]").val(),enabled:n.find("input[name=graph-shown]").is(":checked")},t.constants=r(t.constants),t.percentiles=r(t.percentiles),a=n.find("input[name=graph-sample]").val(),a&&(t.sample=parseInt(a,10)),a=n.find("input[name=graph-refresh-interval]").val(),a&&(t.refresh_interval=parseInt(a,10)),e.entries.push({id:n.attr("data-graph"),options:t})}),e}function It(t){t.find("input[name=graph-title]").attr("placeholder",t.find(".name").text())}function St(){Oe("collection-list",function(){Ct("collection")}),Oe("collection-edit",function(){var t=Ae("collection-edit").opts("pane").id||null;$("[data-input=graph]").length>0&&pt("graph",function(t){return nt(t,{})}),$("[data-input=collection]").length>0&&pt("collection",function(t){return nt(t,{exclude:$(t).opts("input").exclude})}),$("[data-input=collection-name]").length>0&&ut("collection-name",function(e){var a=e.find(":input").val();a&&ge({filter:a},"collections").pipe(function(a){a.length>0&&a[0].id!=t?e.attr("title",$.t("collection.mesg_exists")).addClass("error"):e.removeAttr("title").removeClass("error")})}),De("collection-edit",1,function(){t&&O("step-1-graphs",null),setTimeout(function(){$("[data-step=1] fieldset input:first").trigger("change").select()},0)}),De("collection-edit",2,function(){setTimeout(function(){$("[data-step=2] :input:first").select()})}),kt("edit-graph",function(t){var e,a=$(t.target).closest("[data-graph]");e=Ve+"/admin/graphs/"+a.attr("data-graph"),a.data("params")&&(e+="?"+a.data("params")),window.location=e}),kt("move-up move-down",Ot),kt("remove-graph",function(t){var e=$(t.target),a=e.closest("[data-list]");e.closest("[data-listitem]").remove(),j(a),0===k(a)&&O(a,$.t("graph.mesg_none"),"info"),Qa=!0}),kt("show-options hide-options",function(t){var e=$(t.target).closest("[data-listitem]");e.find(".toggle a").toggle(),e.find(".options").toggle()}),je.on("click","button",function(e){var a,n,i,r,s,o=$(e.target);switch(e.target.name){case"graph-add":if(e.target.disabled)return;if(a=o.closest("fieldset"),r=T("step-1-graphs"),n=a.find("input[name=graph]"),!n.data("value"))return e._retry?void g("alert",{message:$.t("graph.mesg_unknown"),callbacks:{validate:function(){setTimeout(function(){n.select()},0)}}}):void $.ajax({url:Ve+"/api/v1/library/graphs/",type:"GET",data:{filter:n.val()},dataType:"json"}).pipe(function(t){t&&n.data("value",t[0]),o.trigger({type:"click",_retry:!0})});i=Wt({id:n.data("value").id,name:n.val()}),n.data("value").link&&i.data("params","linked=1"),i.find("input[name=graph-shown]").attr("checked","checked"),It(i),O(r,null),j(r),n.val(""),n.trigger("change").focus(),Qa=!0;break;case"step-cancel":window.location=Ve+"/admin/collections/";break;case"step-save":At(o.closest("[data-pane]"),t,"collection",Dt);break;case"step-ok":case"step-prev":case"step-next":Tt(e,s)}}).on("change","[data-step=1] fieldset input",function(t){var e=$(t.target),a=e.closest("fieldset"),n=a.find("button[name=graph-add]");a.find("input[name=graph]").val()?n.removeAttr("disabled"):n.attr("disabled","disabled"),t._typing||t._autofill||!e.val()||e.closest("[data-input]").nextAll("button:first").focus()}).on("change","[data-step=1] .scrollarea input[type=checkbox]",function(t){var e=$(t.target);e.closest("[data-listitem]").toggleClass("hidden",!e.is(":checked"))}).on("change","[data-step=1] .scrollarea :input, [data-step=2] :input",function(t){Qa=!0,"graph-range"==t.target.name&&It($(t.target).closest("[data-graph]"))}).on("keyup","[data-step=1] fieldset input",wt),null!==t&&me(t,"collections").pipe(function(a){var n,i,r,s,o={};i=T("step-1-graphs");for(s in a.entries)n=Wt(a.entries[s]),n.find("input[name=graph-title]").val(a.entries[s].options.title||""),n.find("input[name=graph-range]").val(a.entries[s].options.range||""),n.find("input[name=graph-sample]").val(a.entries[s].options.sample||""),n.find("input[name=graph-constants]").val(a.entries[s].options.constants||""),n.find("input[name=graph-percentiles]").val(a.entries[s].options.percentiles||""),a.entries[s].options.enabled?n.find("input[name=graph-shown]").attr("checked","checked"):n.addClass("hidden"),a.entries[s].options.refresh_interval&&n.find("input[name=graph-refresh-interval]").val(a.entries[s].options.refresh_interval);r=Ae("collection-edit"),r.find("input[name=collection-name]").val(a.name),r.find("textarea[name=collection-desc]").val(a.description),a.options&&a.options.refresh_interval&&r.find("input[name=collection-refresh-interval]").val(a.options.refresh_interval),a.parent&&me(a.parent,"collections").pipe(function(t){r.find("input[name=collection-parent]").data("value",t).val(t.name)}),0===i.data("counter")&&O(i,$.t("graph.mesg_none")),j(i),t&&(o.collection=t),ge(o,"graphs").pipe(function(t){var a,n={};for(a in t)n[t[a].id]=t[a];i.find("[data-graph]").each(function(){var t=$(this),a=t.attr("data-graph");n[a]||(t.addClass("unknown"),n[a]={name:$.t("graph.mesg_unknown")}),n[a].link&&t.data("params","linked=1"),e(t,n[a]),It(t)})})})})}function jt(t){var e,a;return t="boolean"==typeof t?t:!1,t?(e=Ae("graph-link-edit"),a={name:e.find("input[name=graph-name]").val(),link:e.find("input[name=graph]").data("value").id,attributes:{}},e.find(".graphattrs [data-listitem]").each(function(){var t=$(this);a.attributes[t.find(".key :input").val()]=t.find(".value :input").val()})):(e=Ae("graph-edit"),a={name:e.find("input[name=graph-name]").val(),description:e.find("textarea[name=graph-desc]").val(),title:e.find("input[name=graph-title]").val(),type:parseInt(e.find("select[name=graph-type]").val(),10),stack_mode:parseInt(e.find("select[name=stack-mode]").val(),10),unit_legend:e.find("input[name=unit-legend]").val(),unit_type:parseInt(e.find("input[name=unit-type]:checked").val(),10),groups:Ht()},e.data("template")&&(a.template=!0,e.data("redirect-params","templates=1"))),a}function Et(t){var e,a;return t.attr("data-group")?(e=$.extend({series:[],options:{}},Vt(t)),T("step-2-groups").find('[data-group="'+t.attr("data-group")+'"] .groupentry').each(function(){e.series.push(Vt($(this)))})):(a=$.extend({},Vt(t)),e={name:a&&a.name||t.attr("data-series"),type:Ue,series:[],options:$.extend({},a.options)},delete a.options,e.series.push(a)),e}function Ht(){var t=T("step-stack-series"),e=T("step-stack-groups"),a=0,n=[];return _(e).each(function(){var t=$(this);t.find(".groupentry").each(function(){n.push($.extend(Et($(this)),{stack_id:a}))}),a++}),_(t,":not(.linked)").each(function(){n.push($.extend(Et($(this)),{stack_id:a}))}),n}function Vt(t){return t.data("source")?t.hasClass("expand")?t.data("source").data("expands")[t.attr("data-series")]:t.data("source").data("value"):t.data("value")}function Nt(t,a){var n,i=T("step-1-metrics");return t||(t=C(i,"data-series")),a.name||(a.name=t),n=y(i).attr("data-series",t).data({expands:{},proxies:[],renamed:!1,value:a}),e(n,a),n}function Bt(t,a){var n,i,r=T("step-2-groups");return t||(t=C(r,"data-group")),a.name||(a.name=t),n=y(r).attr({"data-group":t,"data-list":t}).data({proxies:[],value:a}),n.find("[data-listtmpl]").attr("data-listtmpl",t),i=a.type==Fe?"average":a.type==Je?"sum":a.type==Xe?"normalize":"",e(n,{name:a.name,type:i}),a.options&&(a.options.color&&n.find(".color").removeClass("auto").css("color",a.options.color),a.options.scale&&n.find("a[href=#set-scale]").text(a.options.scale.toPrecision(3)),a.options.unit&&n.find("a[href=#set-unit]").text(a.options.unit),n.find("a[href=#set-consolidate]").text(Gt(a.options.consolidate||la)),a.options.formatter&&n.find("a[href=#set-formatter]").text(a.options.formatter)),n}function Lt(t){var a,n,i=T("step-stack-groups");return n=C(i,"data-stack"),t.name||(t.name=n),a=y(i).attr({"data-stack":t.name,"data-list":t.name}).data("value",t),a.find("[data-listtmpl]").attr("data-listtmpl",n),e(a,{name:t.name}),a}function Mt(t,a,n){var i,r,s,o;switch(t){case ea:r="data-series";break;case aa:r="data-group";break;default:return void console.error("Unknown `"+t+"' proxy type")}return s=a.attr(r),i=y(n).attr(r,s).data("source",a),void 0!==i.attr("data-list")&&i.attr("data-list",s).find("[data-listtmpl]").attr("data-listtmpl",s),a.data("proxies").push(i),o=$.extend({},a.data("value")),t==aa&&(o.type==Fe?o.type="avg":o.type==Je?o.type="sum":delete o.type),e(i,o),o.options&&(o.options.color&&i.find(".color").removeClass("auto").css("color",o.options.color),o.options.scale&&i.find("a[href=#set-scale]").text(o.options.scale.toPrecision(3)),o.options.unit&&i.find("a[href=#set-unit]").text(o.options.unit),i.find("a[href=#set-consolidate]").text(Gt(o.options.consolidate||la)),o.options.formatter&&i.find("a[href=#set-formatter]").text(o.options.formatter)),i}function Pt(t){var a,n,i,r,s,o=$(t.target);switch(-1==["dragstart","dragend"].indexOf(t.type)&&(a=o.closest(".groupitem"),0!==a.length?o=a:"A"==t.target.tagName&&o.attr("href").replace(/\-[^\-]+$/,"").endsWith("#add")||(o=null)),t.type){case"dragstart":if(o.hasClass("linked")||!o.attr("data-series")&&!o.attr("data-group"))return;o.addClass("dragged"),o.attr("data-group")?t.dataTransfer.setData("text/plain","data-group="+o.attr("data-group")):t.dataTransfer.setData("text/plain","data-series="+o.attr("data-series"));break;case"dragend":t.preventDefault(),o.removeClass("dragged");break;case"dragover":if(t.preventDefault(),null===o||!t.dataTransfer.getData("text/plain").startsWith("data-"))return;o.addClass("dragover"),t.dataTransfer.dropEffect="move";break;case"dragleave":if(null===o)return;o.removeClass("dragover");break;case"drop":if(t.preventDefault(),null===o)return;o.removeClass("dragover"),r=T("stack"==Ya["graph-edit"].active?"step-stack-series":"step-2-series"),r.find("["+t.dataTransfer.getData("text/plain")+"]").addClass("linked"),
0===k(r,":not(.linked)")&&O(r,$.t("graph.mesg_no_series")),"A"==t.target.tagName&&(o.trigger("click"),o=T("step-"+Ya["graph-edit"].active+"-groups").find(".groupitem:last")),s=t.dataTransfer.getData("text/plain").split("="),"data-series"==s[0]?(i=T("step-2-series").find("["+t.dataTransfer.getData("text/plain")+"]"),n=Mt(ea,i.data("source"),o),i.hasClass("expand")&&(n.attr("data-series",s[1]),e(n,i.data("source").data("expands")[s[1]]))):(i=T("step-stack-series").find("["+t.dataTransfer.getData("text/plain")+"]"),Mt(aa,i.data("source"),o)),"stack"!=Ya["graph-edit"].active&&T("step-stack-groups").find("["+t.dataTransfer.getData("text/plain")+"] a[href=#remove-item]").trigger("click")}}function zt(){var t=null,e=[];_("step-2-series").each(function(){var a=$(this);t||(t=a.parent()),e.push([a.detach(),Vt(a).position])}),e.sort(function(t,e){return t[1]-e[1]}),$.each(e,function(e,a){a[0].appendTo(t)})}function Rt(t){var a,n,i,r=_("step-1-metrics"),s={origin:[],source:[],metric:{}},o=[];t="boolean"==typeof t?t:!1,r.each(function(){var t=$(this),e=Vt(t),a=e.origin+"/"+e.source+"/"+e.metric;-1==s.origin.indexOf(e.origin)&&s.origin.push(e.origin),-1==s.source.indexOf(e.source)&&s.source.push(e.source),s.metric[a]?(s.metric[a].current++,s.metric[a].count++):s.metric[a]={current:1,count:1}}),r.each(function(t){var e,i,r,l=$(this);if(e=Vt(l),i=e.origin+"/"+e.source+"/"+e.metric,e.name=e.metric,s.origin.length>1?e.name=e.origin+"/"+e.source+"/"+e.name:s.source.length>1&&(e.name=e.source+"/"+e.name),s.metric[i].count>1&&(e.name+=" ("+(s.metric[i].count-s.metric[i].current)+")",s.metric[i].current--),0===t)a=e.name,n=a.length;else{for(r=0;++r<n&&r<e.name.length&&e.name.charAt(r)==a.charAt(r););n=r}o.push([l,e])}),a&&n&&(n-=(a.substr(0,n).match(/\w+$/)||"").length);for(i in o){if(o[i][0].data("renamed")&&!t)return;t&&o[i][0].data("renamed",!1),n>1&&o.length>1&&(o[i][1].name=o[i][1].name.substr(n)),e(o[i][0],o[i][1])}}function Gt(t){switch(t){case la:return"avg";case da:return"last";case ca:return"max";case ua:return"min";case pa:return"sum";default:return""}}function Yt(e){var a,n,i,r,s=Ae("graph-edit"),o=[];a=/\{\{\s*\.([a-z0-9]+)\s*\}\}/i;for(i in e)for(r in e[i].series)n=e[i].series[r],o=o.concat((n.origin+""+n.source+""+n.metric).matchAll(a));return s.data("template")&&(o=o.concat(s.find("textarea[name=graph-desc]").val().matchAll(a)),o=o.concat(s.find("input[name=graph-title]").val().matchAll(a))),o.sort(),t(o)}function Ut(){var t,e,a,n,i,r=Ae("graph-edit");if(t=T("step-3-attrs"),a=Yt(Ht()),0===a.length)return O(t,$.t("graph.mesg_no_template_attr"),"warning"),void t.next(".mesgitem").hide();t.next(".mesgitem").show(),O(t,null),x(t),n=r.data("attrs-data")||{};for(i in a)e=y(t),e.find(".key input").val(a[i]),void 0!==n[a[i]]&&e.find(".value input").val(n[a[i]])}function Ft(){Oe("graph-list",function(){A("graphs",function(t,e){e.template?t.find("a[href=#show-graph]").remove():t.find("a[href=#add-graph]").remove(),e.link&&(t.data("params","linked=1"),t.find(".name").attr("title",$.t("graph.mesg_linked")).addClass("linked"))}),Ct("graph"),kt("add-graph",function(t){window.location=Ve+"/admin/graphs/add?linked=1&from="+$(t.target).closest("[data-itemid]").attr("data-itemid")})}),Oe("graph-edit",function(){var t=Ae("graph-edit"),a=t.opts("pane").id||null;$("[data-input=source]").length>0&&pt("source",function(t){var e,a=t.closest("fieldset").find("input[name=origin]"),n={};return e=a.closest("[data-input]").opts("input"),e.ignorepattern&&-1!=a.val().indexOf(e.ignorepattern)||(n.origin=a.val()),nt(t,n)}),$("[data-input=metric]").length>0&&pt("metric",function(t){var e,a=t.closest("fieldset"),n=a.find("input[name=origin]"),i=a.find("input[name=source]"),r={};return e=n.closest("[data-input]").opts("input"),e.ignorepattern&&-1!=n.val().indexOf(e.ignorepattern)||(r.origin=n.val()),e=i.closest("[data-input]").opts("input"),e.ignorepattern&&-1!=i.val().indexOf(e.ignorepattern)||(r.source=(i.data("value")&&i.data("value").source.endsWith("groups/")?"group:":"")+i.val()),nt(t,r)}),$("[data-input=graph-name]").length>0&&ut("graph-name",function(t){var e=t.find(":input").val();e&&ge({filter:e},"graphs").pipe(function(e){e.length>0&&e[0].id!=a?t.attr("title",$.t("graph.mesg_exists")).addClass("error"):t.removeAttr("title").removeClass("error")})}),De("graph-edit",1,function(){var e=$("[data-step=1] fieldset");t.find("button[name=auto-name]").show(),e.find("button[name=metric-update], button[name=metric-cancel]").hide(),a&&O("step-1-metrics",null),setTimeout(function(){e.find("input:first").trigger("change").select()},0)}),De("graph-edit",2,function(){var e,a,n=_("step-1-metrics"),i=!1,r=[];return t.find("button[name=auto-name]").hide(),0===n.length?(g("alert",{message:$.t("metric.mesg_missing"),callbacks:{validate:function(){setTimeout(function(){$("[data-step=1] fieldset input:first").select()},0)}}}),!1):(a=T("step-2-series"),e=T("step-2-groups"),x(a),n.each(function(){var t,n=$(this),s=n.data("value");t=Mt(ea,n,a),(s.source.startsWith("group:")||s.metric.startsWith("group:"))&&(r.push([s.origin,s.source,s.metric]),i=!0,t.addClass("expandable")),e.find('[data-series="'+n.attr("data-series")+'"]').length>0&&t.addClass("linked")}),zt(),k(a,":not(.linked)")>0&&O(a,null),void(i?$.ajax({url:Ve+"/api/v1/library/expand",type:"POST",contentType:"application/json",data:JSON.stringify(r)}).pipe(function(t){t&&_(a).each(function(e){var a=$(this);return a.hasClass("expandable")?(t[e]&&t[e].length>0?(a.find(".count").text(t[e].length),t[e].length>1&&(a.data("expand",t[e]),a.find("a[href$=#collapse-series]").remove())):(a.find(".count").text(0),a.find("a[href$=#expand-series], a[href$=#collapse-series]").remove()),void($.isEmptyObject(T("step-1-metrics").find('[data-series="'+a.attr("data-series")+'"]').data("expands"))||a.find("a[href$=#expand-series]").trigger("click"))):(a.find(".count").remove(),void a.find("a[href$=#expand-series], a[href$=#collapse-series]").remove())})}):(a.find(".count").remove(),a.find("a[href$=#expand-series], a[href$=#collapse-series]").remove())))}),De("graph-edit",3,function(){var e=$("[data-step=3]");t.find("button[name=auto-name]").hide(),e.find("select:last").trigger("change"),setTimeout(function(){yt(e.find("select[name=graph-unit]").get(0)),e.find(":input:first").select()}),t.find(".tmplattrs").toggle(t.data("template")),t.data("template")&&Ut()}),De("graph-edit","stack",function(){var a=T("step-stack-series"),n=T("step-stack-groups");t.find("button[name=auto-name]").hide(),x(a),parseInt($("[data-step=3] select[name=stack-mode]").val(),10)===qe&&x(n),_("step-2-groups").each(function(){var t,e=$(this);t=Mt(aa,e,a),n.find('[data-group="'+e.attr("data-group")+'"]').length>0&&t.addClass("linked"),e.find(".groupentry").each(function(){Mt(ea,$(this).data("source"),t)})}),_("step-2-series").each(function(){var t,i,r,s=$(this);return s.hasClass("linked")?void n.find('[data-series="'+s.attr("data-series")+'"]').remove():(i=Mt(ea,s.data("source"),a).attr("data-series",s.attr("data-series")),n.find('[data-series="'+s.attr("data-series")+'"]').length>0&&i.addClass("linked"),t=Mt(ea,s.data("source"),i),s.hasClass("expand")?(r=s.data("source").data("expands")[s.attr("data-series")],i.find(".name:first").text(r.name)):r=s.data("source").data("value"),e(t,r),void(s.hasClass("expand")&&i.addClass("expand")))}),k(a,":not(.linked)")>0&&O(a,null)}),kt("add-average add-sum add-normalize add-stack",function(t){var e;if(t.target.href.endsWith("-stack"))Lt({});else{if(t.target.href.endsWith("-average"))e=Fe;else if(t.target.href.endsWith("-sum"))e=Je;else{if(!t.target.href.endsWith("-normalize"))return;e=Xe}Bt(null,{type:e})}Qa=!0}),kt("collapse-series",function(t){var e,a,n=$(t.target),i=n.closest("[data-series]"),r=i.attr("data-series").split("-")[0];e=T("step-2-groups").find('[data-series^="'+r+'-"]'),a=function(){i.data("source").data("expands",{}),i.siblings('[data-series="'+r+'"]').removeClass("linked"),i.siblings('[data-series^="'+r+'-"]').andSelf().remove(),e.remove(),Qa=!0},e.length>0?g("confirm",{message:$.t("graph.mesg_collapse"),callbacks:{validate:a},labels:{validate:{text:$.t("graph.labl_collapse"),style:"danger"}}}):a()}),kt("expand-series",function(t){var a,n,i,r=$(t.target),s=r.closest("[data-series]"),o=s,l=s.closest("[data-list]"),d=s.data("expand"),c=s.data("source").data("expands"),u=s.attr("data-series");for(n in d)i=u+"-"+n,a=Mt(ea,s.data("source"),l).attr("data-series",i).addClass("expand"),a.detach().insertAfter(o),c[i]||(c[i]={name:(Vt(s).name||u)+" ("+n+")",origin:d[n][0],source:d[n][1],metric:d[n][2]}),e(a,c[i]),c[i].options&&(c[i].options.color&&a.find(".color").removeClass("auto").css("color",c[i].options.color),0!==c[i].options.scale&&a.find("a[href=#set-scale]").text(c[i].options.scale),0!==c[i].options.unit&&a.find("a[href=#set-unit]").text(c[i].options.unit),0!==c[i].options.consolidate&&a.find("a[href=#set-consolidate]").text(c[i].options.consolidate),0!==c[i].options.formatter&&a.find("a[href=#set-formatter]").text(c[i].options.formatter)),a.find(".count").remove(),a.find("a[href$=#expand-series]").remove(),0===parseInt(n,10)&&s.addClass("linked"),o=a;zt(),Qa=!0}),kt("move-up move-down",function(t){var e,a=$(t.target),n=a.closest(".listitem, .groupitem, .groupentry");if(t.target.href.endsWith("#move-up")){if(e=n.prevAll(".listitem, .groupitem, .groupentry").filter(":not(.linked):first"),0===e.length)return;n.detach().insertBefore(e)}else{if(e=n.nextAll(".listitem, .groupitem, .groupentry").filter(":not(.linked):first"),0===e.length)return;n.detach().insertAfter(e)}"stack"!=Ya["graph-edit"].active&&n.hasClass("listitem")&&_("step-2-series").each(function(){var t=$(this);Vt(t).position=t.index()})}),kt("remove-group",function(t){var e,a,n,i=$(t.target);e=i.closest(".groupitem"),e.find(".groupentry a[href=#remove-item]").trigger("click"),a=e.data("proxies");for(n in a)a[n].remove();e.remove(),Qa=!0}),kt("remove-item",function(t){var e,a=$(t.target),n=a.closest(".groupentry");e=n.attr("data-group")?a.closest("[data-step]").find('[data-group="'+n.attr("data-group")+'"]').removeClass("linked"):a.closest("[data-step]").find('[data-series="'+n.attr("data-series")+'"]').removeClass("linked"),O("stack"==Ya["graph-edit"].active?"step-stack-series":"step-2-series",null),a.parent().remove(),Qa=!0}),kt("remove-metric",function(t){var e,a,n=$(t.target),i=n.closest("[data-listitem]"),r=n.closest("[data-list]");i.hasClass("active")&&i.trigger("click"),e=i.data("proxies");for(a in e)e[a].remove();i.remove(),j(r),0===k(r)&&O(r,$.t("metric.mesg_none"),"info"),Rt(),Qa=!0,$("[data-step=1] fieldset input[name=origin]").focus()}),kt("rename-series rename-group rename-stack",function(e){var a,n,i,r,s,o,l=$(e.target);r=e.target.href.endsWith("#rename-stack")?"data-stack":e.target.href.endsWith("#rename-group")?"data-group":"data-series",n=l.closest("["+r+"]"),s=n.attr(r),o=Vt(n).name,i=g("prompt",{message:$.t("data-stack"==r?"graph.labl_stack_name":"graph.labl_series_name"),callbacks:{validate:function(e){e&&(Vt(n).name=e,Ae("graph-edit").find("["+r+'="'+s+'"]').each(function(){$(this).find(".name:first").text(e)}),"data-series"==r&&(n.data("source").data("renamed",!0),t.find("button[name=auto-name]").removeAttr("disabled")),Qa=!0)}}}),a=i.find("input[type=text]").attr({"data-input":"rename-item","data-inputopts":"check: true"}),dt(a.get(0)),a.val(o),ut("rename-item",function(t){var e=t.find(":input").val(),a=[];_("step-1-metrics").add(_("step-2-groups")).each(function(){var t,e=$(this);if(a.push($(this).data("value").name),e.data("expands"))for(t in e.data("expands"))a.push(e.data("expands")[t].name)}),-1!=a.indexOf(e)?(t.attr("title",$.t("graph.mesg_item_exists")).addClass("error"),i.find("button[name=validate]").attr("disabled","disabled")):(t.removeAttr("title").removeClass("error"),i.find("button[name=validate]").removeAttr("disabled"))})}),kt("set-color",function(t){var e,a=$(t.target),n=a.closest("[data-series], [data-group]"),i=n.find(".color");e=g("prompt",{message:$.t("graph.labl_color"),callbacks:{validate:function(t){var e;return Qa=!0,e=Vt(n),t?(i.removeClass("auto").css("color",t),void(e.options=$.extend(e.options||{},{color:t}))):(i.addClass("auto").removeAttr("style"),void(e.options&&delete e.options.color))}},labels:{reset:{text:$.t("main.labl_reset_default")},validate:{text:$.t("graph.labl_color_set")}},reset:""}),e.find("input[name=value]").attr("type","color").val(i.hasClass("auto")?"#ffffff":s(i.css("color")))}),kt("set-scale",function(t){var e=$(t.target),a=e.closest("[data-series], [data-group]"),n=a.find("a[href=#set-scale]"),i=Vt(a);$.ajax({url:Ve+"/api/v1/library/scales/values",type:"GET"}).pipe(function(t){var e,a,r=[],s=i.options&&i.options.scale?i.options.scale:"";$.each(t,function(t,e){r.push([e.name,e.value])}),a=g("select",{message:$.t("graph.labl_scale"),value:s,callbacks:{validate:function(t){t=parseFloat(t),i.options=$.extend(i.options||{},{scale:t}),n.text(t?t.toPrecision(3):"")}},labels:{validate:{text:$.t("graph.labl_scale_set")}},reset:0,options:r}),e=a.find("input[name=value]"),a.find("select").on("change",function(t){t.target.value&&e.val(t.target.value)}).val(s).trigger({type:"change",_init:!0})})}),kt("set-unit",function(t){var e=$(t.target),a=e.closest("[data-series], [data-group]"),n=a.find("a[href=#set-unit]"),i=Vt(a);$.ajax({url:Ve+"/api/v1/library/units/labels",type:"GET"}).pipe(function(t){var e,a,r=[],s=i.options&&i.options.unit?i.options.unit:"";$.each(t,function(t,e){r.push([e.name,e.label])}),a=g("select",{message:$.t("graph.labl_unit"),value:s,callbacks:{validate:function(t){i.options=$.extend(i.options||{},{unit:t}),n.text(t||"")}},labels:{validate:{text:$.t("graph.labl_unit_set")}},reset:0,options:r}),e=a.find("input[name=value]"),a.find("select").on("change",function(t){t.target.value&&e.val(t.target.value)}).val(s).trigger({type:"change",_init:!0})})}),kt("set-consolidate",function(t){var e,a,n=$(t.target),i=n.closest("[data-series], [data-group]"),r=Vt(i),s=r.options&&r.options.consolidate?r.options.consolidate:la;a=g("select",{message:$.t("graph.labl_consolidate"),value:s,callbacks:{validate:function(t){t=parseInt(t,10),r.options=$.extend(r.options||{},{consolidate:t}),i.find("a[href=#set-consolidate]").text(Gt(t))}},labels:{validate:{text:$.t("graph.labl_consolidate_set")}},reset:0,options:[[$.t("graph.labl_consolidate_average"),la],[$.t("graph.labl_consolidate_last"),da],[$.t("graph.labl_consolidate_max"),ca],[$.t("graph.labl_consolidate_min"),ua],[$.t("graph.labl_consolidate_sum"),pa]]}),a.find("button[name=reset]").hide(),a.find(".select").addClass("full").find(".menu .menuitem:first").remove(),e=a.find("input[name=value]").hide(),a.find("select").on("change",function(t){t.target.value&&e.val(t.target.value)}).val(s).trigger({type:"change",_init:!0})}),kt("set-formatter",function(t){var e=$(t.target),a=e.closest("[data-series], [data-group]"),n=a.find("a[href=#set-formatter]"),i=Vt(a);g("prompt",{message:$.t("graph.labl_formatter"),callbacks:{validate:function(t){i.options=$.extend(i.options||{},{formatter:t}),n.text(t||"")}},labels:{validate:{text:$.t("graph.labl_formatter_set")}},reset:""})}),je.on("click","button",function(e){var n,i,r,s,o,l,d,c,u;switch("BUTTON"!=e.target.tagName&&(e.target=$(e.target).closest("button").get(0)),e.target.name){case"auto-name":if(e.target.disabled)return;Rt(!0),t.find("button[name=auto-name]").attr("disabled","disabled");break;case"metric-add":case"metric-update":if(e.target.disabled)return;s=T("step-1-metrics"),r=$(e.target).closest("fieldset"),o=r.find("input[name=metric]"),l=r.find("input[name=source]"),d=r.find("input[name=origin]"),-1!=d.val().indexOf("{{")||-1!=l.val().indexOf("{{")||-1!=o.val().indexOf("{{")?(t.data("template",!0),t.find("button[name=step-save]").children().hide().filter(".template").show()):"metric-update"==e.target.name&&1==k(s)&&(t.data("template",!1),t.find("button[name=step-save]").children().hide().filter(".default").show()),"metric-update"==e.target.name&&(i=_(s,".active")),u=(o.data("value")&&o.data("value").source.endsWith("groups/")?"group:":"")+o.val(),c=i&&i.attr("data-series")||null,n=Nt(c,{name:c||u,origin:d.val(),source:(l.data("value")&&l.data("value").source.endsWith("groups/")?"group:":"")+l.val(),metric:u}),i&&(n.insertBefore(i),i.find("a[href=#remove-metric]").trigger("click")),O(s,null),j(s),o.data("value",null).val(""),o.trigger("change").focus(),r.find("button[name=metric-add]").show(),r.find("button[name=metric-update], button[name=metric-cancel]").hide(),Rt(),Qa=!0;break;case"metric-cancel":T("step-1-metrics").find("[data-listitem^=step-1-metrics-item].active").trigger("click"),$(e.target).closest("fieldset").find("input[name=origin]").focus(),Qa=!0;break;case"stack-config":Ce("graph-edit","stack");break;case"step-cancel":window.location=Ve+"/admin/graphs/";break;case"step-save":At($(e.target).closest("[data-pane]"),a,"graph",jt);break;case"step-ok":case"step-prev":case"step-next":Tt(e,c)}}).on("click","[data-step=1] [data-listitem]",function(t){var e,a,n,i,r,s=$(t.target);s.closest(".actions").length>0||(e=$("[data-step=1] fieldset"),a=s.closest("[data-listitem]"),r=a.data("value"),a.toggleClass("active").siblings().removeClass("active"),n=a.hasClass("active"),e.find("button[name=metric-add]").toggle(!n),e.find("button[name=metric-update], button[name=metric-cancel]").toggle(n),e.find("input[name=origin]").data("value",{name:r.origin,source:"catalog/origins"}).val(n?r.origin:""),i=r.source.startsWith("group:")?{name:r.source.substr(6),source:"library/sourcegroups/"}:{name:r.source,source:"catalog/sources/"},e.find("input[name=source]").data("value",i).val(n?i.name:""),i=r.metric.startsWith("group:")?{name:r.metric.substr(6),source:"library/metricgroups/"}:{name:r.metric,source:"catalog/metrics/"},e.find("input[name=metric]").data("value",i).val(n?i.name:"").trigger("change"))}).on("change","[data-step=1] fieldset input",function(t){var e,a,n=$(t.target),i=n.closest("fieldset");i.find("input[name=origin]").val()?i.find("input[name=source]").removeAttr("disabled"):i.find("input[name=source]").val("").attr("disabled","disabled"),i.find("input[name=source]").val()?i.find("input[name=metric]").removeAttr("disabled"):i.find("input[name=metric]").val("").attr("disabled","disabled"),e=i.find("button[name=metric-add], button[name=metric-update]"),i.find("input[name=origin]").val()&&i.find("input[name=source]").val()&&i.find("input[name=metric]").val()?e.removeAttr("disabled"):e.attr("disabled","disabled"),!t._typing&&n.val()&&(a=n.closest("[data-input]").nextAll("[data-input], button:visible").first(),void 0!==a.attr("data-input")&&(a=a.children("input")),t._autofill&&"BUTTON"==a.prop("tagName")||a.focus())}).on("change","[data-step=3] select, [data-step=3] input[type=radio]",function(e){var a,n=$(e.target);e._init||!e._select&&"SELECT"==e.target.tagName||("stack-mode"==e.target.name&&(n.closest("[data-step]").find("button[name=stack-config]").toggle(parseInt(e.target.value,10)!==qe),Ce("graph-edit","stack",!0)),a=jt(),t.data("template")&&(a.attributes={},t.find(".graphattrs [data-listitem]").each(function(){var t=$(this);a.attributes[t.find(".key :input").val()]=t.find(".value :input").val()}),t.data("attrs-data",a.attributes)),ve(n.closest("[data-step]").find("[data-graph]"),!1,0,a))}).on("change","[data-step=3] :input",function(t){!t._init&&t._select&&(Qa=!0)}).on("keydown","[data-step=1] fieldset input",function(t){$(t.target).nextAll("input").attr("disabled","disabled").val("")}).on("keyup","[data-step=1] fieldset input",wt).on("keypress","[data-step=3] :input[name=graph-desc], [data-step=3] :input[name=graph-title]",function(t){var e=$(t.target),a=e.closest("[data-step]");a.data("attrs-timeout")&&(clearTimeout(a.data("attrs-timeout")),a.removeData("attrs-timeout")),a.data("attrs-timeout",setTimeout(Ut,500))}).on("keypress","[data-step=3] .graphattrs :input",function(e){var a,n;t.data("template")&&(a=$(e.target),n=a.closest(".graphattrs"),n.data("timeout")&&(clearTimeout(n.data("timeout")),n.removeData("timeout")),n.data("timeout",setTimeout(function(){t.find("[data-step=3] select:first").trigger("change")},1e3)))}).on("dragstart dragend dragover dragleave drop",".dragarea",Pt),t.find("button[name=step-save]").children().hide().filter(".default").show(),null!==a&&me(a,"graphs").pipe(function(e){var a,n,i,r,s,o,l,d={};i=T("step-1-metrics"),r=T("step-2-groups"),s=T("step-stack-series");for(o in e.groups){d[e.groups[o].stack_id]||(d[e.groups[o].stack_id]=e.stack_mode!==qe?Lt({name:"stack"+e.groups[o].stack_id}):null),a=e.groups[o].type!==Ue?Bt(null,{name:e.groups[o].name,type:e.groups[o].type,options:e.groups[o].options}):null;for(l in e.groups[o].series)e.groups[o].type!==Ue||e.groups[o].series[l].options||(e.groups[o].series[l].options=e.groups[o].options),-1!=e.groups[o].series[l].origin.indexOf("{{")||-1!=e.groups[o].series[l].source.indexOf("{{")||-1!=e.groups[o].series[l].metric.indexOf("{{")?t.data("template",!0):t.data("template",!1),n=Nt(null,e.groups[o].series[l]).data("renamed",!0),a?Mt(ea,n,a):d[e.groups[o].stack_id]&&Mt(ea,n,d[e.groups[o].stack_id]);a&&d[e.groups[o].stack_id]&&Mt(aa,a,d[e.groups[o].stack_id])}t.data("template")&&t.find("button[name=step-save]").children().hide().filter(".template").show(),t.find("input[name=graph-name]").val(e.name),t.find("textarea[name=graph-desc]").val(e.description),t.find("input[name=graph-title]").val(e.title),t.find("select[name=graph-type]").val(e.type).trigger({type:"change",_init:!0}),t.find("input[name=unit-legend]").val(e.unit_legend),t.find("input[name=unit-type][value="+e.unit_type+"]").prop("checked",!0),t.find("select[name=stack-mode]").val(e.stack_mode).trigger({type:"change",_init:!0}),0===i.data("counter")&&O(i,$.t("metric.mesg_none")),0===s.data("counter")&&O(s,$.t("graph.mesg_no_series")),j(i)})}),Oe("graph-link-edit",function(){var t=Ae("graph-link-edit"),e=t.opts("pane").id||null;$("[data-input=graph-name]").length>0&&ut("graph-name",function(t){var a=t.find(":input").val();a&&ge({filter:a},"graphs").pipe(function(a){a.length>0&&a[0].id!=e?t.attr("title",$.t("graph.mesg_exists")).addClass("error"):t.removeAttr("title").removeClass("error")})}),De("graph-link-edit",1,function(){var t;e||O("step-1-attrs",$.t("graph.mesg_no_template_selected"),"info"),t=n().from,t&&me(t,"graphs").pipe(function(t){ct("graph").find(":input").data("value",{id:t.id,name:t.name,description:t.description,modified:t.modified,template:t.template,source:"library/graphs/?type=template"}).val(t.name).trigger("change"),$("button[name=graph-ok]").trigger("click")}),setTimeout(function(){$("[data-step=1] input").trigger("change").filter(":first").select()},0)}),kt("edit-template",function(){window.location=Ve+"/admin/graphs/"+t.find("input[name=graph]").data("value").id}),je.on("click","button",function(a){var n,i,r=$(a.target);switch(a.target.name){case"graph-ok":if(a.target.disabled)return;i=T("step-1-attrs"),n=t.find("input[name=graph]"),$.ajax({url:Ve+"/api/v1/library/graphs/"+n.data("value").id,type:"GET",dataType:"json"}).pipe(function(e){var r,s,o=Yt(e.groups),l=t.data("attrs-data");if(n.val()||n.val(e.name),0===o.length)return O(i,$.t("graph.mesg_no_template_attr"),"error"),void t.find("button[name=step-save]").attr("disabled","disabled");t.find("button[name=step-save]").removeAttr("disabled"),O(i,null),x(i);for(s in o)r=y(i),r.find(".key input").val(o[s]),l&&void 0!==l[o[s]]&&r.find(".value input").val(l[o[s]]);_(i,":first").find(".value input").trigger("keypress"),a._init||_(i,":first").find(".value input").focus()}),Qa=!0;break;case"step-cancel":window.location=Ve+"/admin/graphs/";break;case"step-save":if(!t.find("input[name=graph]").data("value"))return g("alert",{message:$.t("graph.mesg_missing_template"),callbacks:{validate:function(){setTimeout(function(){t.find("[data-input=graph] input").select()},0)}}}),!1;At(r.closest("[data-pane]"),e,"graph",function(){return jt(!0)})}}).on("change","[data-step=1] [data-input=graph] input",function(t){var e=$(t.target),a=e.closest("[data-input]").nextAll("button:first");e.val()?a.removeAttr("disabled"):a.attr("disabled","disabled"),e.val()&&a.focus()}).on("keypress","[data-step=1] .graphattrs :input",function(t){var e=$(t.target);e.data("timeout")&&(clearTimeout(e.data("timeout")),e.removeData("timeout")),e.data("timeout",setTimeout(function(){ve(e.closest("[data-step]").find("[data-graph]"),!1,0,jt(!0))},1e3))}),null!==e&&me(e,"graphs").pipe(function(e){var a;t.find("input[name=graph-name]").val(e.name).select(),t.data("attrs-data",e.attributes),a=t.find("input[name=graph]").data("value",{id:e.link}),a.closest("[data-input]").nextAll("button:first").removeAttr("disabled").trigger({type:"click",_init:!0}),Qa=!1})})}function Jt(t){var a=y(T("step-1-items")).attr("data-item",t.id).data("value",t);return e(a,t),a}function Xt(){var t=Ae("group-edit"),e={name:t.find("input[name=group-name]").val(),description:t.find("textarea[name=group-desc]").val(),entries:[]};return _("step-1-items").each(function(){e.entries.push($(this).data("value"))}),e}function Kt(){var t;Oe("group-list",function(){Ct("group")}),Oe("group-edit",function(){var e=Ae("group-edit").opts("pane").id||null,a=Ae("group-edit").opts("pane").section;t=function(t){var e=t.closest("fieldset");return 1!=parseInt(e.find("select[name=type]").val(),10)?[]:nt(t,{origin:e.find("input[name=origin]").val()})},$("[data-input=source]").length>0&&pt("source",t),$("[data-input=metric]").length>0&&pt("metric",t),$("[data-input=group-name]").length>0&&ut("group-name",function(t){var n=t.find(":input").val();n&&ge({filter:n},a).pipe(function(a){a.length>0&&a[0].id!=e?t.attr("title",$.t("group.mesg_exists")).addClass("error"):t.removeAttr("title").removeClass("error")})}),De("group-edit",1,function(){var t=$("[data-step=1] fieldset");t.find("button[name=item-update], button[name=item-cancel]").hide(),e&&O("step-1-items",null),setTimeout(function(){t.find("input:first").trigger("change").select()},0)}),De("group-edit",2,function(){return 0===k("step-1-items")?(g("alert",{message:$.t("item.mesg_missing"),callbacks:{validate:function(){setTimeout(function(){$("[data-step=1] fieldset input:first").select()},0)}}}),!1):void setTimeout(function(){$("[data-step=2] :input:first").select()})}),kt("move-up move-down",Ot),kt("remove-item",function(t){var e=$(t.target),a=e.closest("[data-list]");e.closest("[data-listitem]").remove(),j(a),0===k(a)&&O(a,$.t("item.mesg_none"),"info"),Qa=!0}),kt("test-pattern",function(t){var e=$(t.target),n=e.closest("[data-listitem]");$.ajax({url:Ve+"/api/v1/catalog/"+("sourcegroups"==a?"sources":"metrics")+"/",type:"GET",data:{origin:n.data("value").origin,source:n.data("value").source,filter:n.data("value").pattern,limit:$a}}).done(function(t,a,i){var r,s=parseInt(i.getResponseHeader("X-Total-Records"),10);r=P("info",function(t){e.toggleClass("active",t),n.toggleClass("action",t)}).appendTo(je).css({top:e.offset().top,left:e.offset().left}),r.html('<span class="label">'+$.t("item.labl_matching")+"</span><br>"),0===t.length?r.append($.t("main.mesg_nomatch")):$.each(t,function(t,e){r.append(e+"<br>")}),s>t.length&&r.append('…<br><span class="label">'+$.t("item.labl_total")+"</span> "+s)})}),je.on("click","button",function(t){var n,i,r,s,o,l,d,c,u,p;switch(t.target.name){case"item-add":case"item-update":if(t.target.disabled)return;r=$(t.target).closest("fieldset"),o=T("step-1-items"),s=r.find("input[name=item]"),d=r.find("select[name=origin]"),l=r.find("select[name=type]"),"item-update"==t.target.name&&(i=_("step-1-items",".active")),u=l.children("option:selected").text().toLowerCase(),p=parseInt(l.val(),10)!==na,n=Jt({pattern:(p?u+":":"")+s.val(),origin:d.val()}),n.find(".type").text(u),p||n.find("a[href=#test-pattern]").remove(),i&&i.replaceWith(n),O(o,null),j(o),s.val(""),s.trigger("change").focus(),r.find("button[name=item-add]").show(),r.find("button[name=item-update], button[name=item-cancel]").hide(),Qa=!0;break;case"item-cancel":_("step-1-items",".active").trigger("click"),$(t.target).closest("fieldset").find("input[name=item]").focus(),Qa=!0;break;case"step-cancel":window.location=Ve+"/admin/"+a+"/";break;case"step-save":At($(t.target).closest("[data-pane]"),e,"group",Xt);break;case"step-ok":case"step-prev":case"step-next":Tt(t,c)}}).on("click","[data-step=1] [data-listitem]",function(t){var e,a,n,i,r=$(t.target);r.closest(".actions").length>0||(e=$("[data-step=1] fieldset"),a=r.closest("[data-listitem]"),i=a.data("value"),a.toggleClass("active").siblings().removeClass("active"),n=a.hasClass("active"),i=i.pattern.startsWith("glob:")?{origin:i.origin,type:ia,item:i.pattern.substr(5)}:i.pattern.startsWith("regexp:")?{origin:i.origin,type:ra,item:i.pattern.substr(7)}:{origin:i.origin,type:na,item:i.pattern},e.find("button[name=item-add]").toggle(!n),e.find("button[name=item-update], button[name=item-cancel]").toggle(n),e.find("select[name=origin]").val(n?i.origin:"").trigger("change"),e.find("select[name=type]").val(n?i.type:0).trigger("change"),e.find("input[name=item]").val(n?i.item:""))}).on("change","[data-step=1] fieldset input",function(t){var e=$(t.target),a=e.closest("fieldset"),n=a.find("button[name=item-add]");a.find("input[name=item]").val()?n.removeAttr("disabled"):n.attr("disabled","disabled"),t._typing||t._autofill||!e.val()||e.closest("[data-input]").nextAll("button:first").focus()}).on("change","[data-step=2] :input",function(){Qa=!0}).on("keyup","[data-step=1] fieldset input",wt),null!==e&&me(e,a).pipe(function(t){var e,a,n,i;a=T("step-1-items");for(i in t.entries)e=Jt(t.entries[i]),t.entries[i].pattern.startsWith("glob:")||t.entries[i].pattern.startsWith("regexp:")||e.find("a[href=#test-pattern]").remove();n=Ae("group-edit"),n.find("input[name=group-name]").val(t.name),n.find("textarea[name=group-desc]").val(t.description),0===a.data("counter")&&O(a,$.t("item.mesg_none")),j(a)})})}function Zt(){var t=Ae("scale-edit");return{name:t.find("input[name=scale-name]").val(),description:t.find("textarea[name=scale-desc]").val(),value:parseFloat(t.find("input[name=scale-value]").val())}}function qt(){Oe("scale-list",function(){Ct("scale")}),Oe("scale-edit",function(){var t=Ae("scale-edit").opts("pane").id||null;je.on("click","button",function(e){var a=$(e.target);switch(e.target.name){case"step-cancel":window.location=Ve+"/admin/scales/";break;case"step-save":At(a.closest("[data-pane]"),t,"scale",Zt)}}),null!==t&&me(t,"scales").pipe(function(t){var e=Ae("scale-edit");e.find("input[name=scale-name]").val(t.name),e.find("textarea[name=scale-desc]").val(t.description),e.find("input[name=scale-value]").val(t.value)})})}function Qt(){var t=Ae("unit-edit");return{name:t.find("input[name=unit-name]").val(),description:t.find("textarea[name=unit-desc]").val(),label:t.find("input[name=unit-label]").val(),type:parseInt(t.find("input[name=unit-type]:checked").val(),10)}}function te(){Oe("unit-list",function(){Ct("unit")}),Oe("unit-edit",function(){var t=Ae("unit-edit").opts("pane").id||null;je.on("click","button",function(e){var a=$(e.target);switch(e.target.name){case"step-cancel":window.location=Ve+"/admin/units/";break;case"step-save":At(a.closest("[data-pane]"),t,"unit",Qt)}}),null!==t&&me(t,"units").pipe(function(t){var e=Ae("unit-edit");e.find("input[name=unit-name]").val(t.name),e.find("textarea[name=unit-desc]").val(t.description),e.find("input[name=unit-label]").val(t.label),e.find("input[name=unit-type][value="+t.type+"]").prop("checked",!0)})})}function ee(){Oe("catalog-list",function(){kt("show-info",function(t){var e=$(t.target),a=e.closest("[data-itemname]"),n=e.closest("[data-list]").attr("data-list"),i=a.attr("data-itemname");$.ajax({url:Ve+"/api/v1/catalog/"+n+"/"+i,type:"GET"}).pipe(function(t){var i=P("info",function(t){a.toggleClass("action",t)}).appendTo(je).css({top:e.offset().top,left:e.offset().left});switch(n){case"origins":i.html('<span class="label">'+$.t("main.labl_connector")+"</span> "+t.connector);break;case"sources":i.html('<span class="label">'+$.t("main.labl_origins")+"</span> "+t.origins.join(", "));
break;case"metrics":i.html('<span class="label">'+$.t("main.labl_origins")+"</span> "+t.origins.join(", ")+'<br><span class="label">'+$.t("main.labl_sources")+"</span> "+t.sources.join(", "))}})})})}function ae(){$("[data-step]").hide()}function ne(){_e(!0).then(function(){window.print()})}function ie(t){var e,a=$(t.target),n=a.attr("href");if(!(a.closest("[data-graph]").length>0)){if("#set-global-range"==n)a.next(".menu").toggle();else if("#range-custom"==n)e=g("time",{callbacks:{validate:function(){$("[data-graph]").each(function(){var t=$(this);$.extend(t.data("options"),{time:moment(e.find("input[name=time]").val()).format(xa),range:e.find("input[name=range]").val()}),ve(t,!t.inViewport())})}}}),e.find("input[name=time]").appendDtpicker({closeOnSelected:!0,current:null,firstDayOfWeek:1,minuteInterval:10,todayButton:!1}),$("a[href=#set-global-range] + .menu").hide(),t.stopImmediatePropagation();else{if(!n||0!==n.indexOf("#range-"))return 0===a.closest(".menu").length?void $("a[href=#set-global-range] + .menu").hide():void 0;$("[data-graph]").each(function(){var t=$(this);$.extend(t.data("options"),{range:"-"+n.substr(7)}),delete t.data("options").time,ve(t,!t.inViewport())}),a.closest(".menu").hide()}t.preventDefault(),t.stopPropagation()}}function re(t){g("prompt",{message:$.t("main.labl_refresh_interval"),callbacks:{validate:function(e){if(e){if(e=parseInt(e,10),isNaN(e))return void f($.t("main.mesg_invalid_refresh_interval"));$("[data-graph]").each(function(){var t=$(this);$.extend(t.data("options"),{refresh_interval:e}),ve(t,!t.inViewport())}),$(t.target).addClass("value").html("<span>"+e+"</span>")}}}})}function se(t){$(t.target).toggleClass("icon-toggle-off icon-toggle-on active"),$("[data-graph] a[href=#toggle-legend]").trigger("click")}function oe(t){var e=$(t.target),a=e.closest("[data-treeitem]");0===e.closest(".icon").length||!a.hasClass("folded")&&!a.hasClass("unfolded")?window.location=Ve+"/browse/collections/"+a.attr("data-treeitem"):a.toggleClass("folded unfolded").children(".treecntr").toggle(),de(),t.preventDefault(),t.stopPropagation()}function le(){var t;if(localStorage)try{t=JSON.parse(localStorage.getItem("collections-tree")),$("[data-tree=collections] [data-treeitem]").each(function(){var e=$(this);t[e.attr("data-treeitem")]&&e.toggleClass("folded unfolded").children(".treecntr").toggle()})}catch(t){}}function de(){var t;localStorage&&(t={},$("[data-tree=collections] [data-treeitem]").each(function(){var e=$(this);t[e.attr("data-treeitem")]=e.hasClass("unfolded")}),localStorage.setItem("collections-tree",JSON.stringify(t)))}function ce(){le(),je.on("click","[data-tree=collections] a",oe)}function ue(){$("[data-treeitem="+Ae("collection-show").opts("pane").id+"]").addClass("current").parentsUntil("[data-tree]").show(),kt("edit-collection",function(t){window.location=Ve+"/admin/collections/"+$(t.target).closest("[data-pane]").opts("pane").id}),kt("set-global-range",ie),$("a[href=#set-global-range] + .menu .menuitem a").on("click",ie),je.on("click",ie),kt("set-global-refresh",re),kt("toggle-legends",se)}function pe(){kt("edit-graph",function(t){var e,a=$(t.target).closest("[data-pane]").opts("pane");e=Ve+"/admin/graphs/"+a.id,a.linked===!0&&(e+="?linked=1"),window.location=e}),kt("set-global-range",ie),$("a[href=#set-global-range] + .menu .menuitem a").on("click",ie),je.on("click",ie),kt("set-global-refresh",re),kt("toggle-legends",se)}function fe(t,e){return $.ajax({url:Ve+"/api/v1/library/"+e+"/"+t,type:"DELETE"})}function ge(t,e){return $.ajax({url:Ve+"/api/v1/library/"+e+"/",type:"GET",data:t,dataType:"json"})}function me(t,e){return $.ajax({url:Ve+"/api/v1/library/"+e+"/"+t,type:"GET",dataType:"json"})}function he(t,e,a,n){var i="/api/v1/library/"+e+"/",r="POST";return n="boolean"==typeof n?n:!1,n?i+="?inherit="+t:null!==t&&(i+=t,r="PUT"),$.ajax({url:Ve+i,type:r,contentType:"application/json",data:JSON.stringify(a)})}function ve(t,e,n,i){var s;return e="boolean"==typeof e?e:!1,n=n||0,i=i||null,t.length>1?void console.error("Can't draw multiple graph."):(t.data("setup")||Fa.length>0&&(s=Fa.clone(),$.each(t.prop("attributes"),function(){s.attr(this.name,this.value)}),t.replaceWith(s),t=s,t.data({options:t.opts("graph"),setup:!0}),t.find(".graphctrl .ranges").hide(),Ne&&t.find(".graphctrl .edit").hide(),t.find(".placeholder").text(t.data("options").title||"N/A")),t.data("timeout")&&(clearTimeout(t.data("timeout")),t.removeData("timeout")),e?void be(t.get(0)):$.Deferred(function(e){setTimeout(function(){var n,s,o,c;if(t.find(".placeholder").text($.t("main.mesg_loading")),n=t.data("options")||t.opts("graph"),"undefined"==typeof n.zoom&&(n.zoom=!0),"undefined"==typeof n.expand&&(n.expand=!0),"undefined"==typeof n.legend&&(n.legend=!1),n.sample?n.sample=parseInt(n.sample,10):delete n.sample,n.range||(n.range=fa),"undefined"!=typeof n.percentiles)switch(typeof n.percentiles){case"number":n.percentiles=[n.percentiles];break;case"string":n.percentiles=r(n.percentiles)}if("undefined"!=typeof n.constants)switch(typeof n.constants){case"number":n.constants=[n.constants];break;case"string":n.constants=r(n.constants)}return He.startsWith(Ve+"/show/")&&(o=String(window.location.pathname),c=[],n.time&&c.push("time="+n.time.replace("+","%2B")),n.range&&c.push("range="+n.range),n.refresh_interval&&c.push("refresh="+n.refresh_interval),c.length>0&&(o+="?"+c.join("&")),o!=window.location.pathname+window.location.search&&history.replaceState(null,document.title,o)),t.data("options",n),s={time:n.time,range:n.range,sample:n.sample,percentiles:n.percentiles},i?(s.graph=i,n.legend=!1):s.id=t.attr("data-graph"),$.ajax({url:Ve+"/api/v1/plots",type:"POST",contentType:"application/json",data:JSON.stringify(s),dataType:"json"}).pipe(function(r){var s,o,c,u,p,f,g,m,h={},v=[],b={},y=[];if(r.message||!r.series)return t.children(".graphctrl").attr("disabled","disabled").find('a:not([href="#edit"], [href="#refresh"], [href="#reset"]), .legend').attr("disabled","disabled"),t.find(".placeholder").addClass("icon icon-warning").text(r.message?r.message:$.t("graph.mesg_empty_series")).show(),t.children(".graphcntr").empty(),void e.resolve();switch(t.children(".graphctrl").removeAttr("disabled").find('a:not([href="#edit"], [href="#refresh"], [href="#reset"]), .legend').removeAttr("disabled"),t.find(".placeholder").removeClass("icon icon-warning").hide(),p=moment(r.start),f=moment(r.end),o=function(){n.legend&&Highcharts.drawTable.apply(this,[h])},u={chart:{borderRadius:0,events:{load:o,redraw:o,togglePlotLine:function(){var t,e,a=new RegExp("(^| +)active( +|$)");return t=$(this.element),e="plotline-"+this.series.name+"-"+this.name,this.chart.yAxis[0].removePlotLine(e),t.attr("class")&&t.attr("class").match(a)?void t.css({color:"inherit",fill:"inherit"}).attr("class",t.attr("class").replace(a,"")):(this.chart.options._data.plotlines[e]||(this.chart.options._data.plotlines[e]=va[Object.keys(this.chart.options._data.plotlines).length%va.length]),t.css({color:this.chart.options._data.plotlines[e],fill:this.chart.options._data.plotlines[e]}).attr("class",t.attr("class")+" active"),void this.chart.yAxis[0].addPlotLine({id:e,color:this.chart.options._data.plotlines[e],value:this.value,width:1.5,zIndex:3}))}},spacingBottom:2*ha,spacingLeft:ha,spacingRight:ha,spacingTop:ha},credits:{enabled:!1},exporting:{enabled:!1},legend:{enabled:!1},plotOptions:{},series:[],title:{text:null},tooltip:{formatter:function(){var t,e,n,i="<strong>"+moment(this.x).format(ya)+"</strong>",s={};for(t in this.points)s[this.points[t].series.stackKey]||(s[this.points[t].series.stackKey]=[]),s[this.points[t].series.stackKey].push({name:this.points[t].series.name,value:this.points[t].y,color:this.points[t].series.color,symbol:d(this.points[t].series.symbol)});for(e in s){i+='<div class="highcharts-tooltip-block">',n=0;for(t in s[e])i+='<div><span style="color: '+s[e][t].color+'">'+s[e][t].symbol+"</span> "+s[e][t].name+": <strong>"+(null!==s[e][t].value?a(s[e][t].value,{unit_type:r.unit_type}):"null")+"</strong></div>",null!==s[e][t].value&&(n+=s[e][t].value);s[e].length>1&&(i+='<div class="highcharts-tooltip-total">Total: <strong>'+(null!==n?a(n,{unit_type:r.unit_type}):"null")+"</strong></div>")}return i},shared:!0,useHTML:!0},xAxis:{max:f.valueOf(),min:p.valueOf(),type:"datetime"},yAxis:{labels:{formatter:function(){return a(this.value,{unit_type:r.unit_type})}},plotLines:[],title:{text:null}},_data:{plotlines:{}},_opts:r},r.type){case Ke:u.chart.type="area";break;case Ze:u.chart.type="line";break;default:console.error("Unknown `"+r.type+"' chart type")}switch(u.plotOptions[u.chart.type]={animation:!1,lineWidth:1.5,marker:{enabled:!1},states:{hover:{lineWidth:2.5}},threshold:0},i?(u.plotOptions[u.chart.type].enableMouseTracking=!1,t.children(".graphctrl").remove()):(u.title={text:r.title||r.name},u.subtitle={text:p.format(ya)+" — "+f.format(ya)},r.unit_legend&&(u.yAxis.title.text=r.unit_legend),n.zoom&&(u.chart.events.selection=function(e){e.xAxis&&(Te(t,{time:moment(e.xAxis[0].min).format(xa),range:l(moment.duration(moment(e.xAxis[0].max).diff(moment(e.xAxis[0].min))))}),ve(t)),e.preventDefault()},u.chart.zoomType="x")),r.stack_mode){case Qe:u.plotOptions[u.chart.type].stacking="normal";break;case ta:u.plotOptions[u.chart.type].stacking="percent";break;default:u.plotOptions[u.chart.type].stacking=null}s=t.children(".graphcntr"),c=s.highcharts(),c&&($.each(c.series,function(){b[this.name]=this.visible}),$.each(c.yAxis[0].plotLinesAndBands,function(){y.push(this.id)})),v=ye(r.series);for(g in r.series){for(m in r.series[g].plots)r.series[g].plots[m]=[1e3*r.series[g].plots[m][0],r.series[g].plots[m][1]];u.series.push({id:r.series[g].name,name:r.series[g].name,stack:"stack"+r.series[g].stack_id,data:r.series[g].plots,color:r.series[g].options?r.series[g].options.color:null,visible:void 0!==typeof b[r.series[g].name]?b[r.series[g].name]:!0,zIndex:v.indexOf(r.series[g].name)}),h[r.series[g].name]={summary:r.series[g].summary,options:r.series[g].options}}n.legend?(u.chart.spacingBottom=u.series.length*ma+u.chart.spacingBottom,t.data("toggled-legend")&&n.expand&&(s.height(s.outerHeight()+u.series.length*ma),t.data("toggled-legend",!1))):(u.chart.spacingBottom=2*ha,t.data("toggled-legend")&&n.expand&&(s.height(s.outerHeight()-u.series.length*ma),t.data("toggled-legend",!1))),c=s.highcharts(u).highcharts();for(g in n.constants)c.yAxis[0].addPlotLine({color:"#d00",value:n.constants[g],width:1,zIndex:3});y.length>0&&$.each(y,function(e,a){a.startsWith("plotline-")&&(a=a.substr(9)),t.find('.graphcntr .highcharts-table-value[data-name="'+a+'"]').trigger("click")}),n.refresh_interval&&t.data("timeout",setTimeout(function(){ve(t,!t.inViewport())},1e3*n.refresh_interval)),e.resolve()}).fail(function(){t.children(".graphctrl").attr("disabled","disabled").find('a:not([href="#edit"], [href="#refresh"], [href="#reset"]), .legend').attr("disabled","disabled"),t.find(".placeholder").addClass("icon icon-warning").html($.t("graph.mesg_load_failed",{name:"<strong>"+(n.title||t.attr("data-graph"))+"</strong>"})),e.resolve()})},n)}).promise())}function be(t){var e=$(t).offsetParent(),a=e.get(0),n=Ja.indexOf(a);-1==n&&(Ja.push(a),Xa.push([]),n=Ja.length-1,e.on("scroll",_e)),-1==Xa[n].indexOf(t)&&Xa[n].push(t)}function $e(t){var e=document.createElement("canvas"),a=t.find(".graphcntr").highcharts().getSVG();e.setAttribute("width",parseInt(a.match(/width="([0-9]+)"/)[1],10)),e.setAttribute("height",parseInt(a.match(/height="([0-9]+)"/)[1],10)),e.getContext&&e.getContext("2d")?(canvg(e,a),window.location.href=e.toDataURL("image/png").replace("image/png","image/octet-stream")):console.error("Your browser doesn't support mandatory Canvas feature")}function ye(t){var e=t.slice(0),a=[];return e.sort(function(t,e){return t.summary&&e.summary&&t.summary.avg&&e.summary.avg?e.summary.avg-t.summary.avg:0}),$.each(e,function(t,e){a.push(e.name)}),a}function xe(t){var e,a,n,i,r,s,o=$(t.target),d=o.closest("[data-graph]"),c=[];if("disabled"==t.target.getAttribute("disabled"))return void t.preventDefault();if(t.target.href.endsWith("#edit"))r=d.data("options"),i=Ve+"/admin/graphs/"+$(t.target).closest("[data-graph]").attr("data-graph"),r.linked===!0&&(i+="?linked=1"),window.location=i;else if(t.target.href.endsWith("#reframe-all"))d.siblings("[data-graph]").each(function(){var t=$(this),e=d.data("options");Te(t,{time:e.time||null,range:e.range||null}),ve(t,!t.inViewport())}),ve(d);else if(t.target.href.endsWith("#refresh"))ve(d,!1);else if(t.target.href.endsWith("#reset"))Te(d,{time:null,range:null}),ve(d);else if(t.target.href.endsWith("#embed"))r=d.data("options"),r.time&&c.push("time="+r.time.replace("+","%2B")),r.range&&c.push("range="+r.range),r.refresh_interval&&c.push("refresh="+r.refresh_interval),i=Ve+"/show/graphs/"+$(t.target).closest("[data-graph]").attr("data-graph"),c.length>0&&(i+="?"+c.join("&")),window.open(i);else if(t.target.href.endsWith("#export"))$e(d);else if(t.target.href.endsWith("#set-range"))$(t.target).closest(".graphctrl").find(".ranges").toggle();else if(t.target.href.endsWith("#set-time"))r=d.data("options"),e=g("time",{callbacks:{validate:function(){Te(d,{time:moment(e.find("input[name=time]").val()).format(xa),range:e.find("input[name=range]").val()}),ve(d)}}}),e.find("input[name=time]").appendDtpicker({closeOnSelected:!0,current:r.time?moment(r.time).format("YYYY-MM-DD HH:mm"):null,firstDayOfWeek:1,minuteInterval:10,todayButton:!1}),e.find("input[name=range]").val(r.range||"");else if(t.target.href.substr(t.target.href.lastIndexOf("#")).startsWith("#range-"))s=t.target.href.substr(t.target.href.lastIndexOf("-")+1),Te(d,{time:null,range:"-"+s}),ve(d);else if(t.target.href.endsWith("#step-backward")||t.target.href.endsWith("#step-forward"))a=d.children(".graphcntr").highcharts(),n=(a.xAxis[0].max-a.xAxis[0].min)/4,t.target.href.endsWith("#step-backward")&&(n*=-1),Te(d,{time:moment(a.xAxis[0].min).add(n).format(xa),range:d.data("options").range.replace(/^-/,"")}),ve(d);else if(t.target.href.endsWith("#toggle-legend")){var u=d.data("options")||d.opts("graph");o.toggleClass("icon-fold icon-unfold"),d.data("toggled-legend",!0),Te(d,{legend:"boolean"==typeof u.legend?!u.legend:!0}),ve(d)}else{if(!t.target.href.endsWith("#zoom-in")&&!t.target.href.endsWith("#zoom-out"))return;a=d.children(".graphcntr").highcharts(),n=a.xAxis[0].max-a.xAxis[0].min,t.target.href.endsWith("#zoom-in")?(s=l(n/2),n/=4):(s=l(2*n),n=n/2*-1),Te(d,{time:moment(a.xAxis[0].min).add(n).format(xa),range:s}),ve(d)}t.preventDefault()}function ke(t){var e,a=$(t.target),n=a.closest("[data-graph]"),i=n.children(".graphctrl");if("mouseup"==t.type||"mousedown"==t.type)return void(Za="mousedown"==t.type);if(!Za&&0!==i.length&&!i.attr("disabled")){if("mousemove"!=t.type)return 0===a.closest(".step, .actions").length?void n.find(".graphctrl .ranges").hide():(qa&&clearTimeout(qa),void("mouseenter"==t.type?i.addClass("active"):qa=setTimeout(function(){i.removeClass("active")},1e3)));if(e=n.offset(),0===a.closest(".actions").length){if(t.pageX-e.left<=2*ha)return void i.find(".step a[href$=#step-backward]").addClass("active");if(t.pageX-e.left>=n.width()-2*ha)return void i.find(".step a[href$=#step-forward]").addClass("active")}i.find(".step a").removeClass("active")}}function _e(t){var e=[];return t="boolean"==typeof t?t:!1,Ka.draw&&clearTimeout(Ka.draw),Ka.mesg&&clearTimeout(Ka.mesg),$.Deferred(function(a){Ka.draw=setTimeout(function(){var n,i,r,s=0,o=0;Ka.mesg=setTimeout(function(){g("loader",{message:$.t("graph.mesg_loading")})},1e3);for(i in Xa){for(r in Xa[i])Xa[i][r]?(n=$(Xa[i][r]),(t||n.inViewport())&&(e.push(ve(n,!1,o)),Xa[i][r]=null,t&&(o+=ga))):s+=1;s==Xa[i].length&&(Ja.splice(i,1),Xa.splice(i,1),$(Ja[i]).off("scroll",_e))}$.when.apply(null,e).then(function(){Ka.mesg&&clearTimeout(Ka.mesg),m("loader"),a.resolve()})},200)}).promise()}function we(){var t=$("[data-graph]");Fa=$(".graphtmpl").removeClass("graphtmpl").detach(),t.each(function(){var t,e=this.getAttribute("data-graph");e&&(t=$(this),ve(t,!t.inViewport()))}),t.length>0&&Highcharts.setOptions({global:{useUTC:!1}}),Ee.on("resize",_e),je.on("mouseup mousedown mousemove mouseleave","[data-graph]",ke).on("mouseenter mouseleave",".graphctrl .step, .graphctrl .actions",ke).on("click","[data-graph] a",xe).on("click",".graphlist a",_e)}function Te(t,e){var a;e=$.extend(t.data("options"),e);for(a in e)"boolean"==typeof e[a]||e[a]||delete e[a];t.data("options",e)}function Ce(t,e,a){var n,i;a="boolean"==typeof a?a:!1,null===Ya[t].active&&Ya[t].callbacks.init(),e&&Ya[t].callbacks["step-"+e]()!==!1&&!a&&(n=Ae(t),n.find("[data-step="+e+"]").show().siblings("[data-step]").hide(),i=!isNaN(parseInt(e,10)),n.find("button[name^=step-]").toggle(i),n.find("button[name=step-ok]").toggle(!i),1==parseInt(e,10)?n.find("button[name=step-prev]").attr("disabled","disabled"):n.find("button[name=step-prev]").removeAttr("disabled"),parseInt(e,10)==Ya[t].count?(n.find("button[name=step-next]").attr("disabled","disabled"),n.find("button[name=step-save]").removeAttr("disabled")):(n.find("button[name=step-next]").removeAttr("disabled"),n.find("button[name=step-save]").attr("disabled","disabled")),1==Ya[t].count&&n.find("button[name=step-prev], button[name=step-next]").hide(),Ya[t].last=Ya[t].active,Ya[t].active=e)}function Ae(t){return $("[data-pane="+t+"]")}function Oe(t,e){Ya[t]={count:0,active:null,last:null,callbacks:{init:e}},$("[data-pane="+t+"] [data-step]").each(function(){var e=parseInt(this.getAttribute("data-step"),10);!isNaN(e)&&e>Ya[t].count&&(Ya[t].count=e)})}function We(){$("[data-pane]").each(function(){var t=this.getAttribute("data-pane");Ya[t]&&null===Ya[t].active&&Ce(t,Ya[t].count>0?1:null)})}function De(t,e,a){return Ya[t]?void(Ya[t].callbacks["step-"+e]=a):void console.error("Unable to find `"+t+"' registered pane")}function Ie(){return $.ajax({url:Ve+"/static/messages.json",type:"GET"}).pipe(function(t){$.i18n.init({lng:"en",resStore:{en:{translation:t}}})})}var Se=$(document.head),je=$(document.body),Ee=$(window),He=String(window.location.pathname),Ve=Se.find("meta[name=url-prefix]").attr("content")||"",Ne="true"==Se.find("meta[name=read-only]").attr("content"),Be=9,Le=13,Me=16,Pe=27,ze=37,Re=38,Ge=39,Ye=40,Ue=1,Fe=2,Je=3,Xe=4,Ke=1,Ze=2,qe=1,Qe=2,ta=3,ea=1,aa=2,na=1,ia=2,ra=3,sa=1,oa=2,la=1,da=2,ca=3,ua=4,pa=5,fa="-1h",ga=250,ma=24,ha=16,va=["#16a085","#27ae60","#2980b9","#8e44ad","#2c3e50","#f39c12","#d35400","#c0392b"],ba=50,$a=10,ya="MMMM D YYYY, HH:mm:ss",xa="YYYY-MM-DDTHH:mm:ss.SSSZ";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),String.prototype.startsWith||(String.prototype.startsWith=function(t){return this.substr(0,t.length)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.substr(-t.length)===t}),String.prototype.matchAll||(String.prototype.matchAll=function(t){var e,a,n,i=[];for(t.global||(a=t.toString(),n=a.lastIndexOf("/"),t=new RegExp(a.substr(a.indexOf("/")+1,n-1),a.substr(n+1)+"g"));e=t.exec(this);)0!==e.length&&i.push(e[1]);return i}),$.event.props.push("dataTransfer"),$.fn.extend({inViewport:function(){var t=$(this),e=Ee.scrollTop(),a=e+Ee.height(),n=t.offset().top,i=n+t.height();return a>=n&&i>=e},opts:function(t){return this.attr("data-"+t+"opts")?o(this.attr("data-"+t+"opts")):{}}}),window.Highcharts&&(Highcharts.drawTable=function(t){var e,n,i=this,r=i.options,s=["min","avg","max","last"],o={},l=i.plotLeft,c=i.plotTop+i.plotHeight+2.5*ha,u={},p=function(t){var e=$(t.target).closest(".highcharts-table-group"),a=e.find(".highcharts-table-series").text();u[a]&&clearTimeout(u[a]),u[a]=setTimeout(function(){"mouseover"==t.type&&e.parent().find(".highcharts-table-action").css("visibility","hidden"),e.children(".highcharts-table-action").css("visibility","mouseover"==t.type?"visible":"hidden")},"mouseenter"==t.type?0:500)};n=l,e=$(i.container),e.find(".highcharts-table-group").remove(),$.each(i.series,function(e,a){var u,f,g;o[a.name]=i.renderer.g().attr({class:"highcharts-table-group"}).add(),a.visible||$(o[a.name].element).css("opacity",.35),f=i.renderer.text("",l-.5*ma,c+e*ma+ma/2).attr({class:"highcharts-table-action",color:r.plotOptions.area.dataLabels.style.color}).css({cursor:"pointer",display:"none",fontFamily:"FontAwesome",opacity:.25,visibility:"hidden"}).add(o[a.name]).element,Highcharts.addEvent(f,"click",function(){var t=$(f),e=i.get(t.text());e.group.toFront()}),Highcharts.addEvent(f,"mouseenter mouseout",function(t){$(t.target).css("opacity","mouseenter"==t.type?1:.25),p(t)}),f=i.renderer.text(d(a.symbol),l,c+e*ma+ma/2).css({color:a.color}).add(o[a.name]).element,Highcharts.addEvent(f,"mouseenter mouseout",p),f=i.renderer.text(a.name,l+ma,c+e*ma+ma/2).attr({class:"highcharts-table-series"}).css({cursor:"pointer"}).add(o[a.name]).element,Highcharts.addEvent(f,"click",function(){var t=i.get($(f).text());t.setVisible(!t.visible)}),Highcharts.addEvent(f,"mouseenter mouseout",p),u=f.getBBox(),n=Math.max(n,u.x+u.width+ma),t[a.name]&&t[a.name].summary&&(g=Object.keys(t[a.name].summary),g.sort(),$.each(g,function(t,e){-1==s.indexOf(e)&&s.push(e)}))}),$.each(s,function(e,s){var l,d,u=n,p=0;$.each(i.series,function(e,f){var g,m;d=i.renderer.text(s,u,c+e*ma+ma/2).attr({class:"highcharts-table-label"}).css({color:r.plotOptions.area.dataLabels.style.color}).add(o[f.name]).element,0===p&&(l=d.getBBox(),p=l.x+l.width+.35*ma),g=t[f.name]&&t[f.name].summary&&void 0!==t[f.name].summary[s]?t[f.name].summary[s]:null,m={unit_type:r._opts.unit_type},t[f.name].options&&(m=$.extend(m,t[f.name].options)),d=i.renderer.text(null!==g?a(g,m):"null",p,c+e*ma+ma/2).attr({class:"highcharts-table-value","data-name":f.name+"-"+s,"data-value":g}).css({cursor:"pointer"}).add(o[f.name]).element,Highcharts.addEvent(d,"click",function(t){r.chart.events&&r.chart.events.togglePlotLine&&r.chart.events.togglePlotLine.apply({chart:i,element:t.target,name:s,series:f,value:parseFloat($(t.target).closest(".highcharts-table-value").attr("data-value"))||null})}),l=d.getBBox(),n=Math.max(n,l.x+l.width+ma)})}),e.closest("[data-graph]").on("mouseenter mouseleave",function(t){e.find(".highcharts-table-action").toggle("mouseenter"==t.type)})}),$.ajaxSetup({complete:function(t){var e={};if(!(t.status<400)){try{e=JSON.parse(t.responseText)}catch(t){}f(e.message||$.t("main.mesg_unknown_error"))}}});var ka,_a={},wa=0,Ta=1;u(wa,p);var Ca,Aa={};u(wa,b);var Oa={},Wa={};u(Ta,D),u(Ta,W),u(Ta,I),u(wa,B);var Da,Ia=null,Sa={};Ee.on("resize",function(){U(null,!1)}),u(wa,Y);var ja,Ea,Ha=null,Va=!1,Na=null;Ee.on("resize",function(){at(null,!1)}),je.on("click",K),u(wa,et);var Ba,La={},Ma={},Pa={},za={};je.on("click","[data-input] [data-menuitem]",it).on("focusout","[data-input] :input",rt).on("keyup","[data-input] :input",st),u(wa,ft);var Ra;je.on("change","[data-select] select",mt).on("click","[data-select] .selectlabel, [data-select] [data-menuitem]",ht).on("focusin focusout","[data-select]",vt),u(wa,xt);var Ga={};je.on("click","a",_t);var Ya={},Ua=null;String(window.location.pathname).startsWith(Ve+"/admin/")&&(u(wa,ae),u(Ta,St),u(Ta,Ft),u(Ta,Kt),u(Ta,qt),u(Ta,te),u(Ta,ee)),He.startsWith(Ve+"/browse/")&&(kt("print",ne),u(Ta,ce),He.startsWith(Ve+"/browse/collections/")&&u(Ta,ue),He.startsWith(Ve+"/browse/graphs/")&&u(Ta,pe));var Fa,Ja=[],Xa=[],Ka={},Za=!1,qa=null;u(Ta,we);var Qa=!1;Ee.on("beforeunload",function(){return Qa?$.t("main.mesg_unsaved_changes"):void 0}),u(Ta,We),u(wa,Ie),c(wa).then(function(){c(Ta)})});